# Rè¯­è¨€å…¥é—¨ä¸æ•°æ®åˆ†æ-----------------------------------------------------------
# Creator: Fan-Yingfei
# Create based on the note by Fangyi Li
# æœ¬ç¬”è®°åŸºäºå“”å“©å“”å“©å¼¹å¹•ç½‘è§†é¢‘ï¼šRè¯­è¨€å…¥é—¨ä¸æ•°æ®åˆ†æï¼ˆupä¸»idï¼šåŸºå› å­¦é™¢ï¼‰æ€»ç»“è€Œæˆã€‚
# This note is created based on a video, Introduction to R programming language 
# and data analysis, on the website of Bilibili (id: åŸºå› å­¦é™¢).

# P1-6    Introduction of R-----------------------------------------------------

# æ•°æ®é‡‡é›† -> æ•°æ®æŒ–æ˜ï¼ˆData miningï¼‰
#   - ä¸‰ä¸ªç‰¹ç‚¹
#     - æ•°æ®æ•´ä½“æ€§
#     - ä¸è¿½æ±‚ç²¾ç¡®æ€§
#     - å› æœå…³ç³»ï¼ˆxï¼‰
#     - ç›¸å…³æ€§ï¼ˆâˆšï¼‰
#   - é€šè¿‡ç®—æ³•å‘ç°æ–°ä¸œè¥¿ï¼ˆè§„å¾‹ï¼‰-> ç›¸åŒæ•°æ®ä¸åŒç»“æœ -> ç»“æœå¯è§†åŒ–ï¼ˆæ•°æ®å»æŠ½è±¡åŒ–ï¼‰ 
#     -> å†³ç­–

# Rè¯­è¨€ç‰¹ç‚¹
#   - ç¼–ç¨‹å¼€æºï¼ˆå¤§é‡æ‹“å±•åŒ…ï¼‰
#   - ç»˜å›¾åŠŸèƒ½
#   - é¢å‘å¯¹è±¡
#   - ä¸å¤Ÿè§„èŒƒã€ä¸æ”¯æŒå¤šçº¿ç¨‹
#   - å‡½æ•°åå¿…é¡»æ¥æ‹¬å·

getwd()
# çœ‹è·¯å¾„
setwd()
# ä¿®æ”¹è·¯å¾„
getwd()
setwd("/Users/nan-fan/Desktop/Rè½¯ä»¶å­¦ä¹ /RData/")


df <- read.table("dataname.cvs", sep=",", header = T)
# dfå°†æ•°æ®æ–‡ä»¶å‘½å
# read.table()è¯»å†™Excelæ•°æ®æ–‡ä»¶
# sep=","æ¥è¡¨ç¤ºç©ºæ ¼ç”¨å­—ç¬¦

table(df$supp, df$dose)
# table()ç”¨äºåˆ¶ä½œæ–°è¡¨æ ¼ï¼Œ$ç”¨äºç»Ÿè®¡æ€»é‡
# aggregate()æµ‹é‡å‡å€¼ã€æ–¹å·®ç­‰

 

# P7-14   Rçš„å®‰è£…--------------------------------------------------------------

# - ç”¨ "<-" èµ‹å€¼ç»™ä¸€ä¸ªå±€éƒ¨å˜é‡
# - ç”¨ "<<-" èµ‹å€¼ç»™ä¸€ä¸ªå…¨å±€å˜é‡
# - "<-"çš„å¿«æ·é”®ï¼šalt + - 

# é€‰é¡¹tools-global option
# è®¾ç½®studioçš„ç•Œé¢ç­‰
# escé”®å¯ä»¥ä¸­æ–­å½“å‰æ“ä½œ

mean()
# mean(1:5) -> 3 æ±‚1-5çš„å¹³å‡æ•°
# mean(1,2,3,4,5) -> 1 åªè¾“å‡ºç¬¬ä¸€ä¸ªå‘é‡ï¼ˆ1ï¼‰çš„å¹³å‡æ•°ï¼Œåé¢ä¸ºæ— æ•ˆè¾“å…¥
# mean(c(1,2,3,4,5)) -> 3 å¢åŠ çš„c()å¸®åŠ©è¯†åˆ«ä¸€ä¸²æ•°å­—

ls()
# åˆ—å‡ºæ‰€æœ‰å˜é‡

ls.str()
# åˆ—å‡ºæ‰€æœ‰å˜é‡çš„è¯¦ç»†ä¿¡æ¯

str()
# æ‹¬å·é‡Œå¡«å†™å˜é‡åï¼Œè¾“å‡ºå˜é‡çš„ä¿¡æ¯

rm()
# æ¸…é™¤æŸä¸ªå˜é‡
# æ¸…é™¤ä¹‹åæ˜¯æ— æ³•æ¢å¤çš„

rm(y,z)
# å¯ä»¥åˆ é™¤ä»yåˆ°zå¤šä¸ªå˜é‡

list = ls()
# è®©lsçš„å€¼å¤åˆ¶ç»™list

rm(list = ls())
# æ¶ˆé™¤æ‰€æœ‰å˜é‡

history()
# å”¤å‡ºå†å²
# å¯ä»¥åˆ©ç”¨æ–¹å‘é”®ä¸Šä¸‹æ¥æœå¯»å†å²å‘½ä»¤ï¼Œç„¶åå¯ä»¥ç”¨æ–¹å‘é”®å·¦å³é”®æ¥æ›´æ”¹

history(25)
# å¯ä»¥ç»™history()åˆ—å‡ºä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºåªåˆ—å‡ºæœ€è¿‘çš„25æ¡å‚æ•°

Ctrl + L
# æ¸…ç©ºå±å¹•

save.image()
# ä¿å­˜å·¥ä½œç©ºé—´ï¼ˆå›¾ç‰‡ä¸ä¼šè‡ªåŠ¨ä¿å­˜ï¼‰

q()
# é€€å‡ºR

# Ræ‹“å±•åŒ…å®‰è£…
# - åœ¨çº¿
#   é€šè¿‡è®¿é—®é•œåƒç«™ç‚¹
#   æ‹“å±•åŒ…çš„åå­—éƒ½éœ€è¦è¢«å¼•å·
install.package()
# eg. install.package("vcd")
install.packages()
# eg. install.packages(c("a", "b", "c"))
# - ç¦»çº¿ï¼ˆæºä»£ç ï¼‰
#   é•œåƒç«™ç‚¹ä¸‹è½½æºä»£ç 
#   éœ€è¦æ³¨æ„åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»
# å¦‚æœåŸé•œåƒç«™ç‚¹ä¸å¯ç”¨ï¼Œåˆ™éœ€è¦ä¿®æ”¹ç«™ç‚¹ã€‚R-profile.setæ–‡ä»¶
# ä½¿ç”¨.libPaths()èƒ½å¤Ÿæ˜¾ç¤ºåº“æ‰€åœ¨çš„ä½ç½®

library()
# å¯ä»¥æ˜¾ç¤ºåº“é‡Œæœ‰å“ªäº›å®‰è£…åŒ…

library(vcd)
# è½½å…¥éœ€è¦çš„RåŒ…ï¼Œä¸éœ€è¦æ·»åŠ ""

require()
# åŠ è½½åŒ…ï¼ˆeg. require(vcd)ï¼‰

help(package="") # eg. help(package="vcd")
# æŸ¥çœ‹åŒ…ä¸­å†…å®¹å’Œå®ä¾‹ï¼Œ

ls("package:") # eg. ls("package:vcd)
# åˆ—å‡ºRåŒ…ä¸­æ‰€æœ‰åŒ…å«çš„å‡½æ•°
 
data(package="") # eg. data(package="vcd")
# åˆ—å‡ºRåŒ…ä¸­æ‰€æœ‰åŒ…å«çš„æ•°æ®é›†

detach() # eg. detach("package:vcd")ï¼Œå¯ç”¨require()é‡æ–°åŠ è½½
remove.packages() # eg. remove.packages("vcd")ï¼Œåˆ é™¤ä¹‹ååˆ™æ— æ³•å†ä½¿ç”¨
# å»é™¤åŒ…

installed.packages()
# å¯ç”¨äºæ‹“å±•åŒ…ç§»æ¤ï¼Œæ¯”å¦‚ï¼š
# åˆ—å‡ºå½“å‰ç¯å¢ƒä¸­å·²åˆ—å‡ºçš„RåŒ…

# è€è®¾å¤‡
Rpack <- installed.packages() [,1] # Rpackèµ‹å€¼æ‰€æœ‰æ‹“å±•åŒ…çš„åå­—
save(Rpack, file = "Rpack.Rdata") # ä¿å­˜æ–‡ä»¶

# æ–°è®¾å¤‡ 
for (i in Rpact) install.packages(i)
# for å¾ªç¯è¯­å¥

# æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£
# è½¯ä»¶-Help-R help
# help.start()
# help() # help(sum)
# ?å‡½æ•°åï¼ˆä¸€ä¸ªé—®å·æŸ¥å‡½æ•°ï¼‰eg. ?mean
# args() # args(plot)ï¼Œç›´æ¥è¾“å‡ºplotå‡½æ•°éœ€è¦çš„å‚æ•°ï¼Œè€Œä¸ä¼šç›´æ¥æ‰“å¼€å‡½æ•°çš„è¯¦ç»†ä¿¡æ¯
# example() # eg. example(mean)ï¼Œç»™å‡ºå‡½æ•°å®ä¾‹
# help(package=) # eg.help(package=ggplot2)ï¼ŒæŸ¥çœ‹æŸä¸ªåŒ…çš„å¸®åŠ©æ–‡æ¡£
# ??å‡½æ•°åï¼ˆä¸¤ä¸ªé—®å·æŸ¥æ‹“å±•åŒ…ï¼‰eg. ??heatmap
# help.search("") eg.help.search("heatmap")ï¼Œåœ¨æœ¬åœ°æœç´¢

demo(graphics)
# æŸ¥çœ‹å›¾å½¢å®ä¾‹

apropos(å…³é”®å­—)
# æŸ¥è¯¢æ‹¬å·å†…çš„å…³é”®å­—
# eg. apropos("sum", mod="function")ï¼Œåªåˆ—å‡ºä¸sumæœ‰å…³çš„å‡½æ•°

RSiteSearch("å…³é”®å­—")
# åœ¨Rç½‘å€æŸ¥è¯¢å…³é”®å­— rseek.org

# R -> å¤§æ•°æ® -> æ‰¹é‡åŒ–ã€è‡ªåŠ¨åŒ–
# Excel -> é¼ æ ‡æ“ä½œæ–¹ä¾¿



# P15     Rå†…ç½®æ•°æ®é›†-----------------------------------------------------------

# - å­˜åœ¨datasetsåŒ…ä¸­
# - data()è¾“å‡ºæ‰€æœ‰åŒ…å«çš„æ•°æ®é›† æˆ– data(package = "åŒ…å")
# - å¦‚æœæ•°æ®é‡Œé¢çš„æŸä¸ªå˜é‡è¢«é‡æ–°èµ‹å€¼ï¼Œå¯ä»¥ä½¿ç”¨data("å˜é‡å")æ¥èµ‹å€¼å›æ•°æ®é›†é‡Œçš„å€¼

help(package="datasets")
# Rä¸­æ•°æ®å­˜äºdatasetsåŒ…ä¸­

data()
# Rä¸­å·²æœ‰æ•°æ®é›†


# å‘é‡ -> åç§°
# å› å­ -> åˆ†ç±»
# çŸ©é˜µã€æ•°ç»„ -> ä¸åŒä¸œè¥¿çš„ä¸åŒç±»å‹
# ç±»çŸ©é˜µã€æ•°æ®æ¡†

data.frame()
# åˆ¶ä½œæ•°æ®æ¡†

data(æ•°æ®é›†åç§°, package = "åŒ…å") 
# åªåŠ è½½æ‹“å±•åŒ…é‡Œé¢çš„æ•°æ®é›†ï¼Œå¿½ç•¥åŒ…

data(package=.packages(all.available = TRUE))
# æ˜¾ç¤ºRå†…æ‰€æœ‰å¯ç”¨æ•°æ®é›†


# P16-26  æ•°æ®ç»“æ„ï¼ˆRå‚¨å­˜ç»„ç»‡æ•°æ®çš„æ–¹å¼ï¼‰---------------------------------------

# - æ•°å€¼å‹ï¼Œæ•°å€¼å¯ä»¥ç”¨äºç›´æ¥è®¡ç®—ï¼ŒåŠ å‡ä¹˜é™¤
# - å­—ç¬¦ä¸²å‹ï¼Œå¯ä»¥è¿›è¡Œè¿æ¥ï¼Œè½¬æ¢ï¼Œæå–ç­‰
# - é€»è¾‘å‹ï¼ŒçœŸæˆ–è€…å‡
# - æ—¥æœŸå‹  

#             1. å‘é‡ï¼ˆvectorï¼‰-------------------------------------------------


# - ç”¨å‡½æ•°c()æ¥åˆ›å»ºå‘é‡ï¼ˆæ•°ç»„ï¼‰
# - - c()æ‹¬å·ä¸­å¯ä»¥åŠ æ•°å€¼å‹å˜é‡ï¼Œeg. x <- c(1, 2, 3, 4, 5)
# - - c()æ‹¬å·ä¸­å¯ä»¥åŠ å­—ç¬¦å‹å˜é‡ï¼Œeg. y <- c("one","two","three")
# - é€»è¾‘å‹å‘é‡ï¼šTRUE(T) OR FALSE(F)
# - è¾“å‡ºç­‰å·®æ•°åˆ—
seq(from = èµ·å§‹æ•°, to = ç»“å°¾æ•°, by = é—´éš”, length.out = è¾“å‡ºæ•°é‡)
# - é‡å¤è¾“å‡º
rep(æ•°ç»„, æ¬¡æ•°)
rep(æ•°ç»„, each=å•ä¸ªæ•°å­—é‡å¤æ¬¡æ•°, times=å°†æ•´ä½“å…ƒç´ é‡å¤æ¬¡æ•°)
# - ä¸€ä¸ªæ•°ç»„é‡Œé¢çš„å‘é‡å¿…é¡»æ˜¯åŒä¸€ç±»å‹ï¼Œæ¯”å¦‚æ•°å€¼å‹å’Œå­—ç¬¦ä¸²ä¸èƒ½æ··åˆ
# > a <- c(1, 2, "three")
# > a 
#   "1" "2" "three" # å¯¼è‡´å‰é¢çš„æ•°å­—å‘é‡å…¨éƒ¨å˜æˆå­—ç¬¦ä¸²
# - è¾“å‡ºå˜é‡,å‘é‡åŒ–ç¼–ç¨‹
# > a=2
# > b="Hello,World"
# > a;b
#   2
#   "Hello,World"
# - å‘é‡åŒ–ç¼–ç¨‹å¯ä»¥çœç•¥å¾ªç¯ï¼Œæ¯”å¦‚ï¼š
# > x <- c(1, 2, 3, 4, 5)
# > y <- c(6, 7, 8, 9, 10)
# > x * 2 + y
#   8 11 14 17 20
# > x[x>3]  # åˆ—å‡ºxä¸­å¤§äº3çš„æ•°
# - ä½¿ç”¨c()æ¥æ§åˆ¶å¾ªç¯çš„æ¬¡æ•°
# > x <- c(1, 2, 3, 4, 5)
# > rep(x, c(2, 4, 1, 1, 3))
#   1 1 2 2 2 2 3 4 5 5 5

# - å‘é‡ç´¢å¼•
# æ•°å€¼å‹å‘é‡
x <- c(1:100) # å¯¹xèµ‹å€¼1-100ï¼Œxä¸ºæ•°ç»„
length(æ•°ç»„) # æ•°ç»„ä¸­å…ƒç´ æ•°é‡
æ•°ç»„[ä½ç½®] # è¾“å‡ºæ•°ç»„æŸä¸ªå…ƒç´ ï¼Œeg. x[1] # xä¸­ç¬¬1ä¸ªå…ƒç´ 
æ•°ç»„[-ä½ç½®] # è¾“å‡ºé™¤äº†é€‰ä¸­ä½ç½®å…¶ä½™çš„æ‰€æœ‰å…ƒç´ 
æ•°ç»„[c(ä½ç½®,ä½ç½®,ä½ç½®)] # è¾“å‡ºæ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„å…ƒç´ ï¼Œä½ç½®ä¸èƒ½æ­£è´ŸåŒæ—¶
æ•°ç»„[c(T,F,T,F)] # åˆ©ç”¨é€»è¾‘å‘é‡T,Fï¼Œç›¸å½“äºåˆ©ç”¨ifå¾ªç¯è¯­å¥å¾ªç¯æ‰§è¡Œ
æ•°ç»„[æ•°ç»„>æ•°å€¼ & æ•°ç»„<æ•°å€¼] # eg. y[y>5 & y<9]
# å­—ç¬¦ä¸²å‘é‡
z <- c("one","two","three","four","five")
"one" %in% z # %in%è¡¨ç¤ºå…ƒç´ æ˜¯å¦åœ¨å‘é‡ä¸­
z["one" %in% z] # å°†é€»è¾‘æ¡ä»¶æ·»åŠ åˆ°ç´¢å¼•ä¸­
z[z %in% c("one","two")]
# > z %in% c("one","two")
#   TRUE  TRUE FALSE FALSE FALSE
# > k <- z %in% c("one","two")
# > z[k]
#   "one","two"
# ç»™å‘é‡æ·»åŠ åç§°
names(y) <- c("one","two","three","four","five","six","seven","eight","nine","ten")
æ•°ç»„["åˆ—åç§°"] # eg. y["one"] # é€šè¿‡æ¯ä¸€åˆ—çš„åç§°ï¼ˆè¡¨å¤´ï¼‰æ¥è®¿é—®åˆ—æ•°æ®

# æ·»åŠ æˆ–åˆ é™¤å‘é‡
x[101] <- 101 # å¯¹xç¬¬101ä½èµ‹å€¼101
v <- 1:3 # å…ˆå¯¹vè¿›è¡Œèµ‹å€¼
v[c(4,5,6) <- c(4,5,6)] # å¯¹væ‰¹é‡èµ‹å€¼
append(x = v, values = 99,after = 5) #åœ¨vçš„ç¬¬5ä¸ªå…ƒç´ ä¹‹åæ·»åŠ å…ƒç´ 99
append(x = v, values = 99,after = 0) #åœ¨vçš„å¤´éƒ¨æ·»åŠ å…ƒç´ 99
rm(æ•°ç»„) # eg. rm(v) # åˆ é™¤æ•°ç»„v
# åˆ é™¤å‘é‡ä¸­æŸä¸ªå…ƒç´ 
y[-c(1:3)] # å…ˆæ‰¾å‡ºyä¸­å‰”é™¤åçš„å‘é‡
y <- y[-c(1:3)] # å†ç”¨åŸæ¥çš„å‘é‡åç§°æ›¿æ¢å‰”é™¤åçš„å‘é‡
# ä¿®æ”¹å‘é‡ä¸­å…ƒç´ 
y["four"] <- 100 # å°†ä¿®æ”¹åçš„å€¼èµ‹ç»™å¯¹åº”åç§°
v[2] <- 15 # å°†ä¿®æ”¹åçš„å€¼èµ‹ç»™å¯¹åº”ä½ç½®ï¼Œä¸å¯èµ‹å­—ç¬¦ä¸²
append() # ä½¿ç”¨appendä¸ä¼šmutateç”¨æ¥çš„å‘é‡

# - å‘é‡è¿ç®—
x + 1 # å‘é‡ä¸æ•°çš„è¿ç®—
y <- seq(1,100,length.out = 10) # è¡¨ç¤ºæŒ‰é¡ºåº1-100ï¼Œæ¯é—´éš”10ä¸ªæ•°å‡ºç°ä¸€æ¬¡
x * y # xÂ·y
x ** y # x^y
x %% y # x/yçš„ä½™æ•°
x %/% y # x/yçš„æ•´æ•°éƒ¨åˆ†ï¼ˆæ•´é™¤ï¼‰
# å¾ªç¯ï¼š
# å‘é‡ä¸ªæ•°ä¸åŒä¹Ÿå¯èƒ½å¯ä»¥ç›¸åŠ ï¼Œä½†é•¿çš„å‘é‡ä¸ªæ•°å¿…é¡»æ˜¯çŸ­çš„å‘é‡ä¸ªæ•°çš„æ•´é™¤æ•°ã€‚
# æƒ³è¦å¯¹æ¯”ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œåº”ç”¨ä¸¤ä¸ªç­‰å·==ï¼ˆä¸€ä¸ªç­‰å·ç›¸å½“äºèµ‹å€¼ï¼‰
# å¯è¿”å›é€»è¾‘å€¼
# > x > 2
#   FALSE FALSE TRUE TRUE

# æ•°å­¦å‡½æ•°
abs() # ç»å¯¹å€¼
sqrt() # å¹³æ–¹æ ¹
log(å‘é‡, base = logçš„åº•æ•°) # ä¸åŠ baseé»˜è®¤åº•æ•°æ˜¯e
log10() # baseæ˜¯10çš„log
exp() # ä»¥eä¸ºåº•çš„æŒ‡æ•°
ceiling() # å‘ä¸Šå–æ•´
floor() # å‘ä¸‹å–æ•´
trunc() # å‘é‡å†…å–æ•´

# å››èˆäº”å…¥
round(å‘é‡, digits = ä¿ç•™å°æ•°ç‚¹ä½æ•°)
signif(å‘é‡, digits = æ€»ä¿ç•™ä½æ•°)

# ä¸‰è§’å‡½æ•°
sin()
cos()
tan()

# ç»Ÿè®¡å‡½æ•°
sum() # æ±‚å’Œ
max() # æœ€å¤§å€¼
min() # æœ€å°å€¼
range() # æœ€å¤§ã€å°å€¼
mean() # å‡å€¼
var() # æ–¹å·®ï¼ˆvarianceï¼‰
sd() # æ ‡å‡†å·®ï¼ˆstandard deviationï¼‰
prod() # è¿ä¹˜çš„ç§¯
median() # ä¸­ä½æ•°
quantile(å‘é‡, ç™¾åˆ†æ¯”combine) # é»˜è®¤å››åˆ†ä½æ•° eg. quantile(x, c(0.4,0.5))

# ç´¢å¼•å€¼
which.max() # å‘é‡ä¸­æœ€å¤§å€¼çš„ä½ç½®
which.min() # å‘é‡ä¸­æœ€å°å€¼çš„ä½ç½®
which(å‘é‡==ç›®æ ‡å€¼) # ç›®æ ‡å€¼åœ¨å‘é‡ä¸­çš„ä½ç½®
which(å‘é‡>ç›®æ ‡å€¼) #å¤§äºç›®æ ‡å€¼çš„æ•°åœ¨å‘é‡ä¸­çš„ä½ç½®
å‘é‡(which(å‘é‡>ç›®æ ‡å€¼)) # å¤§äºç›®æ ‡å€¼çš„æ•°åœ¨å‘é‡ä¸­çš„æ•°


#             2. çŸ©é˜µä¸æ•°ç»„ï¼ˆmatrixï¼‰-------------------------------------------

# ï¼ˆå¤šç»´çš„å‘é‡ï¼‰
matrix(å‘é‡, nrow = è¡Œæ•°, ncol = åˆ—æ•°, byrow = T/F) # åˆ¶ä½œä¸€ä¸ªçŸ©é˜µ
matrix(å‘é‡, è¡Œæ•°, åˆ—æ•°) # å¯ä»¥ç›´æ¥å†™
# å‘é‡ä¸­å…ƒç´ ä¸ªæ•°å¿…é¡»å¤§äºæˆ–ç­‰äºmatrixçš„æ ¼æ•°ï¼ˆè¡Œæ•° x åˆ—æ•° <= å…ƒç´ æ•°ï¼‰
# Data length must be a sub-multiple or multiple of the number of rows
# byrow = T æ—¶matrixå…ˆå¡«è¡Œï¼Œå†å¡«åˆ—ï¼Œåä¹‹äº¦ç„¶

dimnames(matrix) <- list(è¡Œåé›†, åˆ—åé›†)
# å¦‚ä½•åŠ è¡Œã€åˆ—å

dim(å‘é‡) # è¾“å‡ºå‘é‡çš„ç»´åº¦ï¼Œä¹Ÿå¯ç›´æ¥èµ‹å€¼æ¥æ”¹å˜å‘é‡çš„ç»´åº¦
# > dim(x) # x <- c(1, 2)
#   NULL
# > dim(x) <- c(1, 2)  # ä¸ºå‘é‡xæ·»åŠ ç»´æ•°ï¼Œå¯å°†å‘é‡å˜ä¸ºçŸ©é˜µ
# >  x
#       [,1] [,2]
#   [1,]  1   2
# > dim(x) <- c(2,2,5) # å¯æ·»åŠ å¤šç»´ï¼Œå°†å‘é‡å˜ä¸ºå¤šç»´æ•°ç»„

# æ•°ç»„ï¼ˆæ›´å¤šç»´ï¼‰
array(å‘é‡, ç»´æ•°é›†, dimnames = ç»´åº¦åçš„list)
# eg. array(1:6, c(1, 2, 3)æŒ‡1è¡Œ2åˆ—3å±‚, dimnames = list(c("A1"), 
#                                                     c("B1", "B2"),  
#                                                     c("C1", "C2", "C3")))

# çŸ©é˜µç´¢å¼•
matrix[è¡Œæ•°, åˆ—æ•°] # åˆ—æ•°å’Œè¡Œæ•°ä¸ä¸€å®šåªæ˜¯ä¸€ä¸ªæ•°ï¼Œå¯ä»¥æ˜¯ä¸ªé›†
matrix[è¡Œæ•°] # è®¿é—®æŒ‡å®šè¡Œæ•°çš„ç¬¬ä¸€åˆ—
matrix[è¡Œæ•°,] # è®¿é—®æŒ‡å®šè¡Œæ•°çš„æ•´è¡Œ
matrix[,åˆ—æ•°] # è®¿é—®æŒ‡å®šåˆ—æ•°çš„æ•´åˆ—
matrix[-è¡Œæ•°, åˆ—æ•°] # è®¿é—®é™¤äº†æŒ‡å®šè¡Œæ•°çš„å…¨éƒ¨è¡Œæ•°ï¼Œè€Œåè®¿é—®æŒ‡å®šåˆ—
matrix["è¡Œå", "åˆ—å"] # å¦‚æœmatrixå·²æœ‰è¡Œã€åˆ—åï¼Œä¹Ÿå¯ç›´æ¥ç”¨è¡Œã€åˆ—åç´¢å¼•

# çŸ©é˜µè¿ç®—
# è¡Œåˆ—ä¸ä¸€è‡´çš„ä¸¤ä¸ªçŸ©é˜µæ— æ³•ç›¸åŠ å‡
rowSums(matrix) # matrixæ¯ä¸€è¡Œçš„å’Œ
colSums(matrix) # matrixæ¯ä¸€åˆ—çš„å’Œ
rowMeans() # matrixæ¯ä¸€è¡Œçš„å¹³å‡æ•°
colMeans() # matrixæ¯ä¸€åˆ—çš„å¹³å‡æ•°
matrix1 * matrix2 # å†…ç§¯
matrix1 %*% matrix2 # å¤–ç§¯
diag(matrix) # matrixçš„å¯¹è§’çº¿å€¼
t(matrix) # matrixçš„è¡Œåˆ—äº’æ¢


#             3. åˆ—è¡¨ï¼ˆlistï¼‰---------------------------------------------------
# åˆ—è¡¨æ˜¯ä¸€äº›å¯¹è±¡çš„æœ‰åºé›†åˆï¼Œå¯ä»¥å­˜å‚¨è‹¥å¹²å‘é‡ã€çŸ©é˜µã€æ•°æ®æ¡†ï¼Œç”šè‡³å…¶ä»–åˆ—è¡¨çš„ç»„åˆ

# åˆ¶ä½œåˆ—è¡¨
list(ç¬¬ä¸€ä¸ªå¯¹è±¡,ç¬¬äºŒä¸ªå¯¹è±¡, ...) 
list(ç¬¬ä¸€å¯¹è±¡å = ç¬¬ä¸€ä¸ªå¯¹è±¡, ç¬¬äºŒå¯¹è±¡å = ç¬¬äºŒä¸ªå¯¹è±¡, ...) 
# ä¸ºå¯¹è±¡æ·»åŠ åç§°ï¼Œåå¯é€šè¿‡åç§°ç›´æ¥è®¿é—®å¯¹è±¡
 
# è®¿é—®å•ä¸ªå¯¹è±¡
åˆ—è¡¨å[å¯¹è±¡ä½ç½®]
åˆ—è¡¨å["å¯¹è±¡å"] # è¿™é‡Œè®¿é—®éœ€è¦åŠ å¼•å·

# è®¿é—®å¤šä¸ªå¯¹è±¡
åˆ—è¡¨å[c(å¯¹è±¡1ä½ç½®, å¯¹è±¡2ä½ç½®, ...)]
åˆ—è¡¨å[c("å¯¹è±¡1å", "å¯¹è±¡2å", ...)] 
åˆ—è¡¨å$å¯¹è±¡å # ä¸€èˆ¬å¯¹è±¡åä¼šè‡ªåŠ¨ç»™

# ***mlist[1]å’Œmlist[[1]]çš„åŒºåˆ«***
mlist[1]
# ç±»å‹ä¸ºlist, è¾“å‡ºçš„ä¸ºåˆ—è¡¨è‡ªèº«çš„å†…å®¹
# è¦åˆ å‡åˆ—è¡¨å¯ä»¥ä½¿ç”¨å•æ‹¬å·è´Ÿç´¢å¼•ï¼Œå¦‚ï¼šmlist[-2]ç­‰äºå»é™¤ç¬¬äºŒä¸ªlist
mlist[[1]]
# è¾“å‡ºçš„ä¸ºåˆ—è¡¨å¯¹åº”å†…å®¹çš„ç±»å‹
# ç±»å‹ä¸ºä¸€å¼€å§‹ç»„æˆåˆ—è¡¨çš„å…ƒç´ ï¼Œå¦‚vectorã€matrixç­‰ï¼ˆä¹Ÿå¯èƒ½æ˜¯åˆ—è¡¨ï¼‰
# æ‰€ä»¥è¦æ”¹æˆ–åŠ mlisté‡Œé¢çš„å…ƒç´ ï¼Œéœ€è¦ä¸¤ä¸ªæ‹¬å·
# åˆ å‡åˆ—è¡¨å¯ä»¥æŠŠlisté‡Œé¢çš„å…ƒç´ èµ‹å€¼NULLï¼Œeg. mlist[[1]] <- NULL

# åˆ å‡éƒ½ä¼šé€ æˆæ‰€æœ‰çš„æ•°æ®åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®å˜åŒ–

# ***å•åŒä¸­æ‹¬å·çš„åŒºåˆ«***
# æŠŠåˆ—è¡¨å½“ä½œä¸€åˆ—ç«è½¦ï¼Œå•ä¸­æ‹¬å·ç›¸å½“äºé€‰æ‹©æŸèŠ‚è½¦å¢ï¼ŒåŒä¸­æ‹¬å·ç›¸å½“äºé€‰æ‹©æŸèŠ‚è½¦å¢é‡Œçš„å†…å®¹

#             4. æ•°æ®æ¡†ï¼ˆæ•°æ®é›†ï¼‰-----------------------------------------------
# æ•°æ®æ¡†æ˜¯ä¸€ç§è¡¨æ ¼å¼çš„æ•°æ®ç»“æ„ï¼Œæ•°æ®æ¡†æ—¨åœ¨æ¨¡æ‹Ÿæ•°æ®é›†ã€‚
# æ•°æ®é›†æ˜¯ç”±æ•°æ®æ„æˆçš„ä¸€ä¸ªå·¨å‹æ•°ç»„ã€‚

# - è¡Œï¼ˆrowï¼‰è¡¨ç¤ºè§‚æµ‹ï¼ˆobjectï¼‰
# - åˆ—ï¼ˆcolumnï¼‰è¡¨ç¤ºå˜é‡ï¼ˆdoseï¼‰
#       col1  col2  col3
# row1
# row2
# row3

# çŸ©é˜µå¿…é¡»ä¸ºåŒä¸€æ•°æ®ç±»å‹
# æ•°æ®æ¡†æ¯ä¸€åˆ—å¿…é¡»åŒä¸€ç±»å‹ï¼Œä½†æ¯ä¸€è¡Œå¯ä»¥ä¸åŒã€‚

?data.frame # æŸ¥çœ‹å¸®åŠ©æ–‡ä»¶
data.frame(å˜é‡1, å˜é‡2, ...) # åˆ¶ä½œæ•°æ®æ¡†
# å°†æ•°æ®å­˜å‚¨åˆ°Rè¿›è¡Œåˆ†æï¼Œåªéœ€å°†æ¯ä¸ªå†…å®¹å•ç‹¬å­˜å‚¨ä¸ºä¸€ä¸ªå‘é‡ï¼Œç”¨data.frameåˆå¹¶å³å¯

# è®¿é—®æ•°æ®æ¡†
æ•°æ®é›†[åˆ—/"åˆ—å"] # å¯ä»¥ç”¨c()ä¸€æ­¥æŸ¥çœ‹å¤šåˆ—ï¼Œä¼šè¾“å‡ºä¸€ä¸ªå¸¦è¡Œçš„æ–°æ•°æ®æ¡†
æ•°æ®é›†["è¡Œå",] # ä¸€è¡Œ + å…¨åˆ—
æ•°æ®é›†[, "åˆ—å"] # å…¨è¡Œ + ä¸€åˆ—
# åˆ—/è¡Œå‰æ·»åŠ -ï¼Œè¡¨ç¤ºå»æ‰è¯¥åˆ—/è¡Œ
æ•°æ®é›†$åˆ—å # å…¨è¡Œ + ä¸€åˆ—  
# å¯ä½¿ç”¨è¯¥æ–¹å¼ç»˜åˆ¶æ•£ç‚¹å›¾ï¼Œeg. plot(æ•°æ®é›†$åˆ—å1,æ•°æ®é›†$åˆ—å1
# å¯ä½¿ç”¨çº¿æ€§å›å½’ï¼Œeg. lm(åˆ—å1,åˆ—å2, data = æ•°æ®é›†)

with(æ•°æ®é›†, {åˆ—å}) # ç›´æ¥è¾“å‡ºå…¨åˆ—

attach(æ•°æ®é›†) # æŠŠæ•°æ®é›†çš„åˆ—åå¯¼å…¥Rï¼Œä¹‹åå¯ä»¥ç›´æ¥è®¿é—®
detach(æ•°æ®é›†) # æ¶ˆé™¤æ•°æ®é›†çš„åˆ—å


#             5. å› å­ï¼ˆfactorï¼‰-------------------------------------------------

# å˜é‡ç±»å‹ï¼š
#   - åä¹‰å‹ï¼ˆnominalï¼‰ï¼šæ— é¡ºåºçš„/é¡¹ç›®ä¹‹é—´æ˜¯ç‹¬ç«‹çš„/æ¯”å¦‚åå­—
#   - æœ‰åºå‹ï¼ˆordinalï¼‰ï¼šé¡¹ç›®ä¹‹é—´æœ‰å…³è”ä½†ä¸æ˜¯è¿ç»­çš„æ•°é‡å˜åŒ–/æ¯”å¦‚poor, better, best
#   - è¿ç»­å‹ï¼ˆcontinuousï¼‰ï¼šæœ‰é¡ºåºçš„/è¿ç»­çš„æ•°é‡å˜åŒ–/æ¯”å¦‚é‡‘é¢ã€å¢äº§ç‡ç­‰

# åä¹‰å‹ï¼ˆnominalï¼‰å’Œæœ‰åºå‹ï¼ˆordinalï¼‰éƒ½å±äºå› å­
# åä¹‰å‹ï¼ˆnominalï¼‰å’Œæœ‰åºå‹ï¼ˆordinalï¼‰å˜é‡çš„å¯èƒ½å€¼ä¸ºæ°´å¹³(level)
# æ°´å¹³å€¼ï¼ˆlevelï¼‰æ„æˆçš„å‘é‡ä¸ºå› å­
# å› å­çš„ä½œç”¨ï¼šè®¡ç®—æ¦‚ç‡å’Œé¢‘æ•°ã€ç‹¬ç«‹æ€§æ£€éªŒã€ç›¸å…³æ€§æ£€éªŒã€æ–¹å·®åˆ†æã€ä¸»æˆåˆ†åˆ†æã€å› å­åˆ†æ...

# eg.
# > ?mtcars
# > mtcars$cyl
#   [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4
# > table(mtcars$cyl) # è®¡ç®—é¢‘æ•°  # mtcars$cylä½œä¸ºå› å­
#    4  6  8  # å› å­çš„æ°´å¹³å€¼
#   11  7 14  # é¢‘æ•°

# factors      Lever 1     Level 2     Level 3
# * $ &
# * * *   ->    ****        $$          &&&
# $ & &

# å› å­å‹æ•°æ®
factor(c(æ•°æ®é›†), orderred = T/F, levels = c("level1", "level2", ...))
# ä¼šè¾“å‡ºæ•°æ®é›†å’Œlevelsçš„é¡ºåº
# factorå‰ä¸€èˆ¬éœ€è¦èµ‹å€¼ï¼Œeg. week <- factor(...)

# å°†å‘é‡è½¬åŒ–ä¸ºå› å­
fcyl <- factory(mtcars$cyl)

# ç»˜å›¾ï¼ˆå› å­è¾“å‡ºæ¡å½¢å›¾ğŸ“Šï¼Œå‘é‡è¾“å‡ºæ•£ç‚¹å›¾ï¼‰

# æ•£ç‚¹å›¾
# ^ level
# | 
# |         ...
# |     ...
# | ...
# |
# ----------------> index

# æ¡å½¢å›¾
# ^ æ•°é‡
# | 
# |         ---
# |     --- | |
# | --- | | | |
# | | | | | | |
# ----------------> level

hist(MyMclust$uncertainty) # ç»˜åˆ¶ç›´æ–¹å›¾ï¼ˆå‘½ä»¤è¯¦è§Cubox#hist)


# cut(è¢«åˆ†å‰²çš„å‘é‡, (æŠŠ0åˆ°100, æ€»levelæ•°é‡ä¸º10, ç­‰åˆ†10ä»½))
cut(1:100, c(seq(0, 100, 10)))
cut(å‘é‡, c(seq(0, 100, 10)))

class(æ•°æ®é›†) # eg. class(state.region) # æŸ¥æ‰¾å½“å‰æ•°æ®é›†çš„ç±»åˆ«

#             6. ç¼ºå¤±æ•°æ®-------------------------------------------------------

# - æµ‹é‡å€¼ä¸¢å¤±
# - æ²¡æœ‰å€¼
# - æ— æ•ˆå€¼

# NAè¡¨ç¤ºç¼ºå¤±å€¼ï¼ˆNAä¸ä¸€å®šç­‰äºé›¶ï¼‰
# > 1 + NA
#   NA
# > NA == 0
#   NA 

# å‡½æ•°ä¸­å…³äºç¼ºå¤±å€¼çš„å‚æ•°
na.rm = T/F # æ˜¯å¦ç§»é™¤ç¼ºå¤±å€¼ï¼ˆæ³¨ï¼šé€‰äº†Tåï¼Œå‡½æ•°è®¡ç®—ç›¸å½“äºç¼ºå¤±å€¼ä»æœªå‡ºç°ï¼‰
is.na(æ•°æ®é›†) # é¢„å…ˆæŸ¥è¯¢æ•°æ®é›†ä¸­æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼

# æ¶ˆé™¤å‘é‡ä¸­çš„NA
na.omit(åŸå‘é‡) # å¦‚æœæ˜¯æ•°æ®é›†ä½¿ç”¨na.omit()ï¼Œä¼šæŠŠæœ‰NAçš„æ•´è¡Œéƒ½åˆ é™¤æ‰

# å…¶ä»–ç¼ºå¤±æ•°æ®

# æ’è¡¥ç¼ºå¤±å€¼
# å•ä¸ªæ’è¡¥ï¼ˆç®€å•ï¼‰ï¼šHmiscåŒ…
# å¤šé‡æ’è¡¥ï¼šMiåŒ…, MiceåŒ…, ameliaåŒ…, mitoolsåŒ…

NaN # ä»£è¡¨ä¸å¯èƒ½çš„å€¼ï¼ˆæ¯”å¦‚0/0ï¼‰ï¼Œä¸å­˜åœ¨çš„ 
is.nan() # æŸ¥è¯¢æ˜¯å¦ä¸ºNaN

Inf # ä»£è¡¨æ­£æ— ç©·ï¼ˆ1/0ï¼‰
-Inf # ä»£è¡¨è´Ÿæ— ç©·ï¼ˆ-1/0ï¼‰
is.infinite() # æŸ¥è¯¢æ˜¯å¦ä¸ºæ— ç©·
!is.infinite() # å‰”é™¤æ•°æ®é›†ä¸­ä¸ºæ— ç©·çš„æ•°

Na # æ˜¯å­˜åœ¨çš„ï¼Œä½†ä¸çŸ¥é“æ˜¯å¤šå°‘


#             7. å­—ç¬¦ä¸²ï¼ˆstring/strï¼‰-------------------------------------------

# è¦åŠ å¼•å·ï¼

æ­£åˆ™è¡¨è¾¾å¼ 

nchar() # å‘é‡ä¸­æ¯ä¸ªå…ƒç´ ï¼ˆå­—ç¬¦ä¸²ï¼‰çš„é•¿åº¦
length() # å‘é‡ä¸­å…ƒç´ çš„ä¸ªæ•°

paste() # ç²˜è´´å­—ç¬¦ä¸²ï¼Œå°†å¤šä¸ªå­—ç¬¦ä¸²åˆå¹¶ä¸ºä¸€ä¸ª
# > paste(c("a", "b", "c"))
#   "a" "b" "c" # å› ä¸ºc()ï¼Œä¸‰ä¸ªå‘é‡ä¸åœ¨ä¸€ä¸ªç»´åº¦ï¼Œåˆ†åˆ«å¤„ç†
# > paste("a", "b", "c")
#   "a b c" # é»˜è®¤æ˜¯ç©ºæ ¼åˆ†å‰²
# > paste("a", "b", "c", sep="-")
#   "a-b-c" # sepä¸ºåˆ†å‰²å‚æ•°
# > f <- c("m","n","l")
# > paste(f,"a","b","c")
#   "m a b c" "n a b c" "l a b c"

substr(å‘é‡, start = ç¬¬ä¸€ä¸ªå­—ç¬¦, stop = æœ€åçš„å­—ç¬¦) # ç”¨äºæå–éƒ¨åˆ†å­—ç¬¦
# eg. substr(x = month.name, strat = 1,stop = 3)

toupper() # å…¨å¤§å†™
tolower() # å…¨å°å†™
sub # åªè¿›è¡Œä¸€æ¬¡æ›¿æ¢ï¼Œå°†å­—æ¯æ›¿æ¢ä¸ºé¦–å­—æ¯å¤§å†™
gsub # è¿›è¡Œå…¨å±€æ›¿æ¢ï¼Œå°†å­—æ¯æ›¿æ¢ä¸ºé¦–å­—æ¯å¤§å†™
# ä½¿ç”¨æ­£åˆ™åŒ–è¯­è¨€
gsub("^(\\w)","\\U\\1",tolower(å­—ç¬¦å‹å‘é‡))
gsub("^(\\w)","\\U\\1",tolower(å­—ç¬¦å‹å‘é‡),perl = T) # é¦–å­—æ¯å¤§å†™
gsub("^(\\w)","\\L\\1",tolower(å­—ç¬¦å‹å‘é‡),perl = T) # é¦–å­—æ¯å°å†™

grep # æŸ¥æ‰¾å­—ç¬¦ä¸²
# > x <- c("b","A+","AC")
# > grep("A+",x) # æ­£åˆ™åŒ–è¯­è¨€ä¸­ï¼Œ+å¯ä»£è¡¨1-æ­£æ— ç©·ä¸ªå­—ç¬¦
#   2 3
# > grep("A+",x,fixed = T)
#   2
# > grep("A+",x,fixed = F)
#   2 3

match() # æŸ¥æ‰¾åŒ…å«äº
# eg.
# > match("AC",x)
#   3

# ç”¨äºåˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ä¸æ˜¯å‘é‡
strsplit(å­—ç¬¦ä¸²å‘é‡/é›†, "åˆ†éš”ç¬¦") 
# > path <- "/usr/local/bin/p"
# > strsplit(path,"/")
#   ""      "usr"   "local" "bin"   "p"
# > path <- "usr/local/bin/p"
# > strsplit(path,"/")
#   "usr"   "local" "bin"   "p"

# å¯¹å‘é‡1å’Œå‘é‡2ä½¿ç”¨åˆ¶å®šå‡½æ•°
outer(å‘é‡1, å‘é‡2, FUN = å‡½æ•°å)


#             8. æ—¥æœŸå’Œæ—¶é—´ï¼ˆdateï¼‰---------------------------------------------

# å¯¹æ—¶é—´åºåˆ—çš„æè¿°
# åˆ©ç”¨å‰é¢çš„ç»“æœè¿›è¡Œé¢„æµ‹

"ts" # time series æ—¶é—´æ•°æ®çš„ç®€ç§°
# tsä¸æ˜¯æ•°æ®æ¡†,data.frameæ˜¯æ•°æ®æ¡†ï¼Œæ‰å¯ä»¥ç”¨ $ å‡½æ•°å¼•ç”¨æŸåˆ—

Sys.Date() # æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´

# å°†æ•°å­—å˜ä¸ºæ—¥æœŸç±»
as.Date(å‘é‡, format = "%Y-%m-%d") # %yæŒ‡ç›´æ¥å¹´ä»½ï¼Œå¦‚20
# ä¾‹å­
a <- "2020-01-01"
class(a) # "character"
class(as.Date(a)) # "Date"ï¼Œæ—¥æœŸç±»

?strftime # æ—¶é—´å‡½æ•°ç›¸å…³ä»‹ç»

# åˆ›é€ è¿ç»­æ—¶é—´ç‚¹
seq(as.Date("2017-01-01"), as.Date("2017-07-05"), by=5)
# byå‚æ•°ä¸ºç›¸éš”å¤©æ•°ï¼ˆä»èµ·å§‹å¼€å§‹ï¼Œæ¯éš”byå¤©å‡ºä¸€ä¸ªæ•°ï¼‰

# ?ts # ç”Ÿæˆæ—¶é—´åºåˆ—ï¼Œå¯ä»¥å°†å‘é‡è½¬åŒ–ä¸ºæ—¶é—´å‡½æ•°
ts(data, 
   start = c(èµ·å§‹å¹´, èµ·å§‹å¹´çš„ç¬¬å‡ ä¸ªé¢‘ç‡å•ä½), 
   end = c(ç»ˆæ­¢å¹´, ç»ˆæ­¢å¹´çš„ç¬¬å‡ ä¸ªé¢‘ç‡å•ä½), 
   frequency = é¢‘ç‡æ•°)
# Creating time-series objects
# frequencyé¢‘ç‡å˜åŒ–ï¼š
# 1 ä»¥å¹´ä¸ºå•ä½
# 12 ä»¥æœˆä»½ä¸ºå•ä½
# 4 ä»¥å­£åº¦ä¸ºå•ä½
# ä¾‹å­ï¼š

# > sales <- round(runif(48, min=50, max=100)) # roundå‡½æ•°ç”¨äºå–æ•´ï¼Œrunifç”Ÿæˆéšæœºæ•°

# > sales
# [1] 56 75 75 85 51 73 63 79 73 88 57 81 72 85 58 60 87 77 55 86 65 71 50 91 64 63 59
# [28] 60 64 82 75 81 60 75 95 50 75 87 79 85 57 50 62 86 52 72 98 97

# > ts(sales, start = c(2010,5), end = c(2014,4), frequency = 1) ä»¥å¹´ä¸ºå•ä½
# Time Series:
# Start = 2014 
# End = 2017 
# Frequency = 1 
# [1] 56 75 75 85

# å› ä¸ºfrequency=1ï¼Œæ‰€ä»¥èµ·å§‹ä¸ºä»2010å¼€å§‹ç®—çš„ç¬¬äº”å¹´ï¼Œå³2014å¹´ã€‚
# ç»“æŸä¸º2014å¼€å§‹ç®—çš„ç¬¬å››å¹´ï¼Œå³2017å¹´ã€‚
# 2014-2017ï¼Œæ€»4å¹´ï¼Œå¯ä»¥æœ‰å››ä¸ªæ•°æ®æŒ‡å‘æ—¶é—´ã€‚
# å› ä¸ºå¯ä»¥fillçš„æ—¶é—´ä¸å¤Ÿï¼Œå¤šä½™çš„æ•°æ®å°±è¢«çœç•¥æ‰äº†ã€‚

# > ts(sales, start = c(2010,5), end = c(2014,4), frequency = 4) ä»¥å­£åº¦ä¸ºå•ä½
#       Qtr1 Qtr2 Qtr3 Qtr4
# 2011   56   75   75   85
# 2012   51   73   63   79
# 2013   73   88   57   81
# 2014   72   85   58   60

# 2010å¼€å§‹çš„ç¬¬äº”å­£åº¦ï¼Œå³2011ç¬¬ä¸€å­£åº¦ï¼›2014å¼€å§‹çš„ç¬¬å››å­£åº¦ï¼Œå³2014ç¬¬å››å­£åº¦ã€‚

# > ts(sales, start = c(2010,5), end = c(2014,4), frequency = 12) ä»¥æœˆä»½ä¸ºå•ä½
#       Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
# 2010                  56  75  75  85  51  73  63  79
# 2011  73  88  57  81  72  85  58  60  87  77  55  86
# 2012  65  71  50  91  64  63  59  60  64  82  75  81
# 2013  60  75  95  50  75  87  79  85  57  50  62  86
# 2014  52  72  98  97                                

 

# P28     è·å–æ•°æ®--------------------------------------------------------------

# 1. é”®ç›˜è¾“å…¥

# Creating a dataframe
patientID <- c(1, 2, 3, 4)
admdate <- c("10/15/2009", "11/01/2009", "10/21/2009", "10/28/20009")
age <- c(25, 34, 28, 52)
diabetes <- c("Type1", "Type2", "Type1", "Type1")
status <- c("Poor", "Improved", "Excellent", "Poor")
data <- data.frame(patientID, admdate, age, diabetes, status) # æ•°æ®æ¡†
#   patientID     admdate age diabetes    status
# 1         1  10/15/2009  25    Type1      Poor
# 2         2  11/01/2009  34    Type2  Improved
# 3         3  10/21/2009  28    Type1 Excellent
# 4         4 10/28/20009  52    Type1      Poor
?edit # å¯ä»¥è°ƒç”¨å…è®¸æ‰‹åŠ¨è¾“å…¥æ–‡æœ¬çš„æ–‡å­—ç¼–è¾‘å™¨
data2 <- data.frame(patientID = character(0), 
                    age = numeric(0), 
                    diabetes = character(0), 
                    status = character(0)) 
data2 <- edit(data2) # å¯è§†ç¼–è¾‘å™¨ï¼Œå¿…é¡»èµ‹å€¼ç»™åŸå®šä¹‰å˜é‡
fix(data2) # å¯é€‰æ‹©fixå‡½æ•°ä¿®æ”¹ï¼Œå¯ç›´æ¥ä¿å­˜




# 2. è¯»å–å¤–éƒ¨æ–‡ä»¶


# 3. è®¿é—®æ•°æ®åº“

# ODBC = open database connectivity å¼€æ”¾æ•°æ®åº“
install.packages("RODBC")
# åŒå‘é€šä¿¡ï¼Œè¯»å†™å’Œå†™å…¥




# P29-30  è¯»å…¥æ–‡ä»¶--------------------------------------------------------------

?read.table()
x <- read.table("input.txt") # é»˜è®¤ç©ºç™½åˆ†å‰² # åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹
x <- read.table("æ–‡ä»¶ç»å¯¹è·¯å¾„/ç›¸å¯¹è·¯å¾„") # æ–‡ä»¶ä¸åœ¨å½“å‰å·¥ä½œè·¯å¾„ä¸‹
# e.g. x <- read.table("/Users/nan-fan/Desktop/Rè½¯ä»¶å­¦ä¹ /RData/input.txt")

x <- read.table("input.csv", sep=",", header = T, skip = 5, nrows = 100, 
                na.strings = " ") 
# sepè®¾ç½®åˆ†éš”ç¬¦ï¼Œæ­¤ä¸ºé€—å·åˆ†å‰²ï¼Œé»˜è®¤ç©ºç™½åˆ†å‰²
# ç¬¬ä¸€è¡Œæ˜¯å¦ä¸ºå˜é‡åç§°
# skipçš„è¡Œæ•°
# nrowsï¼šæ€»å…±å¯¼å…¥å¤šå°‘è¡Œ
# è‡ªåŠ¨è½¬åŒ–ç¼ºå¤±å€¼

head(x, n = 6) # æå–æœ€å¼€å§‹çš„å…­è¡Œï¼ˆé»˜è®¤å…­è¡Œï¼‰
tail(x, n = 6) # æå–æœ€æœ«å°¾çš„å…­è¡Œ

read.csv() # è¯»å–csvæ–‡ä»¶
read.fwf("fwf.txt",wudths = c(3,3)) # fixed width file, éœ€è¦è®¾ç½®å®½åº¦å€¼

read.csv("è·¯å¾„\æ–‡ä»¶å",encoding="utf_8")
# fileEncoding:åœ¨å£°æ˜æ–‡ä»¶ä¸Šä½¿ç”¨çš„ç¼–ç (å³é‡æ–°ç¼–ç å­—ç¬¦æ•°æ®)
# encoding:ä¸ç”¨äºé‡æ–°ç¼–ç è¾“å…¥,åªæ˜¯æ ‡è®°å­—ç¬¦ä¸²ä¸ºå·²çŸ¥ç¼–ç ,å…è®¸Rä»¥æœ¬æœºç¼–ç å¤„ç†ç¼–ç å­—ç¬¦ä¸²
# æ³¨:è¯»å–æ–‡ä»¶æ—¶,ä¹Ÿè¯»å–äº†å­—ç¬¦ç¼–ç é›†

x <- read.table("website", header = T)

install.packages("XML") # ç½‘ç»œè¯»å–æ•°æ®çš„åŒ…
?readHTMLTable
# e.g.
# readHTMLTable("https:...",which=3) # which è¡¨ç¤ºé€‰å–ç¬¬whichä¸ªå›¾è¡¨


install.packages("foreign") # è¯»å–ä¸åŒè½¯ä»¶æ ¼å¼çš„æ•°æ®çš„åŒ…
help(package = "foreign")
# è¦è¯»å–çš„æ–‡ä»¶æ ¼å¼åœ¨foreignåŒ…ä¸­æ²¡æœ‰ï¼Œå¯ä»¥è¿›è¡Œç½‘ç»œæœç´¢
RSiteSearch("Matlab")

# Excelç›´æ¥å¤åˆ¶åˆ°å‰ªè´´æ¿å¯¼å…¥
x <- read.table("clipboard", header = T, sep = "\t") # Windows
x <- read.table(pipe("pbpaste")) # Mac

read.table(gzfile("input.txt.gz")) # gz file

# ä¸è§„åˆ™æ ¼å¼æ–‡ä»¶çš„è¯»å–
?readLines  
readLines("input.csv", n = 5) # n = è¿”å›è¡Œæ•°

?scan # è¯»å–æ–‡ä»¶ä¹‹åï¼Œä¼šæ ¹æ®æŒ‡ä»¤è¿›è¡Œå¤„ç†
scan("input.txt", what = list(numeric(0)))
scan("input.txt", what = list(X1 = character(3),
                              X2 = numeric(0),
                              X3 = numeric(0)))
# æ•°å­—è¡¨ç¤ºè¯»å…¥çš„æ•°é‡ï¼Œ0è¡¨ç¤ºæ‰€æœ‰
# æ¯ä¸€è¡Œè¯»å–3ä¸ªå­—ç¬¦ä¸²å†…å®¹


# P31     å†™å…¥æ–‡ä»¶--------------------------------------------------------------

?write # ç›´æ¥å†™å…¥æ–‡ä»¶ï¼ŒåŒºåˆ«äºreadçš„è¯»å–æ–‡ä»¶
write.table(x, file = "x.txt") # ç›´æ¥å°†æ–‡ä»¶å†™å…¥tableä¸­
# e.g.
x <- read.table("input.txt",header = T)
write.table(x, file = "/Users/nan-fan/Desktop/Rè½¯ä»¶å­¦ä¹ /x.txt")

write.table(x, file = "x.csv", sep = "\t", quote = F, append = F, 
            na = "NA", row.names = F)
# append = Fæ¸…ç©ºæºæ–‡ä»¶ï¼ˆTåŠ åœ¨åŸæ–‡ä»¶åï¼‰
# na é»˜è®¤ç¼ºå¤±å€¼ï¼Œè°ƒæ•´ç¼ºå¤±å€¼çš„å­—ç¬¦
# row.nameså–æ¶ˆè‡ªåŠ¨æ·»åŠ çš„è¡Œå·

# å¯ç›´æ¥å†™ä¸ºå‹ç¼©åŒ…
write.table(mtcars,gzfile("newfile.txt.gz"))
write.csv
write.csv(MyMclust$parameters$pro, "Mclust_proportions.csv", row.names = FALSE)


# P32     è¯»å†™Excelæ–‡ä»¶---------------------------------------------------------

# Excelæ–‡ä»¶å¦å­˜ä¸ºcsvæ ¼å¼
x <- read.csv("æ–‡ä»¶å.csv",header = T)

# å¤åˆ¶å‰ªè´´æ¿
x <- read.table(pipe("pbpaste"))

# Excelçš„æ ¼å¼ï¼š.xlsx

# XLConnectåŒ…ï¼Œéœ€è¦JAVAç¯å¢ƒ
install.packages("XLConnect") # éœ€è¦rJavaåŒ…
# è¯»å–æ–‡ä»¶ï¼ˆä¸¤æ­¥æ³•ï¼‰
x <- loadWorkbook("data.xlsx") # å¯¼å…¥æ–‡æ¡£
edata <- readWorksheet(x, 1) # è¯»å–æ–‡æ¡£ # ä¸åŒçš„å·¥ä½œè¡¨ï¼Œæ•°å­—ä¸ºå·¥ä½œè¡¨ç¼–å·
head(edata) # æŸ¥çœ‹æ•°æ®ï¼Œæ˜¾ç¤ºå‰6è¡Œ
?readWorksheet
readWorksheet(x,1,startRow = 0,startCol = 0,endRow = 50,endCol = 3,header = T)
# è¯»å–æ–‡æ¡£ï¼›è¯»å–æ–‡æ¡£ä¸­å·¥ä½œè¡¨ç¼–å·ï¼›èµ·å§‹è¡Œï¼›èµ·å§‹åˆ—ï¼›ç»ˆæ­¢è¡Œï¼›ç»ˆæ­¢åˆ—ï¼›æ˜¯å¦è¯»å–è¡¨å¤´
# è¯»å–æ–‡ä»¶ï¼ˆä¸€æ­¥æ³•ï¼‰
readWorksheetFromFile("data.xlsx", 1)

# å†™å…¥ï¼ˆå››æ­¥æ³•ï¼‰
y <- loadWorkbook("file.xlsx", create = T) # åˆ›å»ºå·¥ä½œç°¿/æ–‡ä»¶
createSheet(y, "Sheet 1") # åœ¨å·¥ä½œç°¿ä¸­åˆ›å»ºå·¥ä½œè¡¨
writeWorksheet(y, data = x, sheet = "Sheet 1") # å°†æ•°æ®ä¿å­˜åˆ°å·¥ä½œè¡¨ä¸­
saveWorkbook(y) # å°†å·¥ä½œç°¿å­˜ä¸º.xlsxæ–‡ä»¶
# å†™å…¥ï¼ˆä¸€æ­¥æ³•ï¼‰
?writeWorksheetToFile
writeWorksheetToFile("file.xlsx", data = iris, sheet = "Sheet 1")

vignette("XLConnect") # æŸ¥çœ‹æ›´å¤šXLConnectçš„å¸®åŠ©æ–‡æ¡£

# xlsxåŒ…ï¼Œéœ€è¦JAVAç¯å¢ƒ
install.packages("xlsx")
library(xlsx)
help(package="xlsx")
# è¯»å–æ–‡ä»¶
read.xlsx("data.xlsx", 1, startRow = 1, endRow = 100)
# å†™å…¥æ–‡ä»¶
write.xlsx(x, file = "rdata.xlsx", sheetName = "Sheet 1", append = T/F)
# å†™å…¥çš„æ•°æ®ï¼›æ–‡ä»¶åï¼›å·¥ä½œè¡¨åç§°ï¼›æ˜¯å¦è¿½åŠ å†™å…¥

# openxlsxåŒ…ï¼Œä¸ç”¨JAVAç¯å¢ƒ


# P33     è¯»å†™Ræ ¼å¼æ–‡ä»¶---------------------------------------------------------

# .RDS -> R data set
?saveRDS
saveRDS(data, file = "data.RDS") # å‚¨å­˜ä¸ºRDSæ–‡ä»¶è‡³å…¬å…±ç›®å½•
x <- readRDS("data.RDS") # è¯»å…¥RDSæ–‡ä»¶

# .R

# .RData 
load("data.RData") # ä¸¤ä¸ª.RDataæ–‡ä»¶ä¸­ç›¸åŒå˜é‡çš„æ•°æ®ä¼šè¦†ç›–ï¼Œå› æ­¤æœ€å¥½æå‰äº†è§£æ–‡ä»¶å†…å®¹
save(data1, data2, file = "data.RData") # å°†ä¸¤ä¸ªæ•°æ®é›†ä¿å­˜äºåŒä¸€ä¸ª.RDataæ–‡ä»¶
save.image() # ä¿å­˜å½“å‰å·¥ä½œç©ºé—´ä¸­çš„æ‰€æœ‰å¯¹è±¡


# P34-40  æ•°æ®æ ¼å¼è½¬æ¢----------------------------------------------------------

# æ·»åŠ ã€åˆ å‡ã€æ’åºæ•°æ®

# æ•°æ®æ¡†
library(xlsx)
setwd("/Users/nan-fan/Desktop/Rè½¯ä»¶å­¦ä¹ /RData/")
cars32 <- read.xlsx("mtcars.xlsx",sheetIndex = 1,header = T) # å¯¼å…¥æ•°æ®é›†
is.data.frame(data) # ç”¨æ¥åˆ¤æ–­æ•°æ®ç±»å‹
new.data <- as.data.frame(data) # å…¶ä»–æ•°æ®ç±»å‹è½¬æ¢ä¸ºæ•°æ®æ¡†

# æ•°æ®æ¡†è½¬ä¸ºçŸ©é˜µ
data.frame(state.region,state.x77) # åœ¨state.x77æ•°æ®æ¡†ä¸­åŠ å…¥å­—ç¬¦ä¸²state.region
as.matrix(data.frame(state.region,state.x77)) # è¯¥çŸ©é˜µå˜ä¸ºå­—ç¬¦ä¸²
# å¯ç”¨method()æŸ¥çœ‹is/aså‘½ä»¤åŒ…å«çš„å…¨éƒ¨å†…å®¹
method(is)
method(as)
# ç»™å‘é‡æ·»åŠ ä¸€ä¸ªç»´åº¦ï¼Œå°±å˜æˆçŸ©é˜µ/æ•°ç»„
x <- state.abb
dim(x) <- c(5,10)
as.factor(x) # xç¼–ç¨‹å› å­ç±»å‹
as.list(x) # ç”±å‘é‡å˜ä¸ºåˆ—è¡¨
state <- data.frame(x, state.region,state.x77) # åŠ ä¸Šä¸€ä¸ªå› å­å’ŒçŸ©é˜µå°±æ„æˆæ•°æ®æ¡†
state$Income # å–å‡ºæ•°æ®æ¡†ä¸­çš„åˆ—ï¼Œä¸ºå‘é‡
state["Nevada",] # å–å‡ºä¸€è¡Œï¼Œä¸ºæ•°æ®æ¡†ï¼Œå¹¶é™„å¸¦åˆ—å
is.data.frame(state["Nevada",]) # åˆ¤æ–­æ˜¯å¦ä¸ºæ•°æ®æ¡†
y <- state["Nevada",]
unname(y) # å»é™¤åˆ—å
unlist(list) # å°†å…¶è½¬åŒ–ä¸ºå‘é‡

# æ•°æ®å–å­é›†
who <- read.csv("WHO.csv", header = T) # å¯¼å…¥æ•°æ®
head(who)
who1 <- who[c(1:50), c(1:10)] # è¿ç»­æå– # å–å‰50è¡Œï¼Œ10åˆ—ï¼ˆæƒ³è¦çš„é‚£éƒ¨åˆ†ï¼‰
who2 <- who[c(1,3,5,8),c(2,14,16,18)] # ä¸è¿ç»­æå–
View(who2) # æµè§ˆè¡¨æ ¼who2çš„å†…å®¹
who$Continent # ä½¿ç”¨åˆ—å
who2 <- who[which(who$Continent == 7)] # ä½¿ç”¨whichå‡½æ•°æ¥å®šä½ï¼ˆé€»è¾‘åˆ¤æ–­ï¼‰# ç­‰å¼åˆ¤æ–­
who3 <- who[which(who$CountryID > 50 & who$CountryID <= 100)] # å¤šé‡é€»è¾‘
?subset # å–å­é›†
who4 <- subset(who, who$CountryID > 50 & who$CountryID <= 100) # data, logic
?sample # éšæœºæå–éƒ¨åˆ†æ•°æ®
x <- 1:100
sample(x, n, replace = T/F) # nä¸ºè¾“å‡ºæ•°é‡ï¼Œreplaceä¸ºæ˜¯å¦å¯ä»¥é‡å¤ï¼Œå³æ˜¯å¦å¯æ”¾å›
sort(sample(x, n, replace = T/F)) # å¯¹æŠ½æ ·ç»“æœè¿›è¡Œæ’åº
who[sample(who$CountryID, 30, replace = F),] # éšæœºæŠ½å–æ•°æ®é›†CountryID 30ä¸ªå­é›†

# åˆ é™¤å›ºå®šè¡Œ
data[-1:-5] # è´Ÿç´¢å¼•
data$row <- NULL # èµ‹å€¼NULL # ç›¸å½“äºæ¸…ç©ºè¯¥åˆ—æˆ–è¡Œçš„æ•°æ®

# æ•°æ®æ¡†åˆå¹¶->

# åˆå¹¶åˆ—
data.frame(d1, d2) # åˆ›é€ ä¸€ä¸ªæ–°çš„æ•°æ®æ¡†
# data.frame(USArrests,state.division)
?cbind
cbind(d1, d2) # åœ¨ç¬¬ä¸€ä¸ªæ•°æ®æ¡†ä¸‹æ”¹

# åˆå¹¶è¡Œï¼ˆd1å’Œd2åˆ—åå¾—ç›¸åŒï¼‰
?rbind
rbind(d1, d2)
# e.g.
data1 <- head(USArrests,20)
data2 <- tail(USArrests,20)
rbind(data1, data2)

# çŸ©é˜µä¹Ÿå¯ä»¥ç”¨cbindå’Œrbindï¼Œå¿…é¡»æœ‰ç›¸åŒçš„è¡Œæ•°æˆ–åˆ—æ•°
rownames(data4) # ç»Ÿè®¡æ•°æ®é›†çš„è¡Œå
length(rownames(data4)) # ç»Ÿè®¡æ•°æ®é›†çš„è¡Œåä¸ªæ•°ï¼Œä»¥æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤é¡¹
# å»é™¤é‡å¤é¡¹ -> å–å­é›†
duplicated(data)  # åˆ¤æ–­å‘é‡æˆ–æ•°æ®é›†ä¸­å“ªäº›æ˜¯é‡å¤å€¼
data[duplicated(data),] # è¾“å‡ºé‡å¤éƒ¨åˆ†
data[!duplicated(data),] # è¾“å‡ºéé‡å¤éƒ¨åˆ†
unique(data) # ç›´æ¥å»é™¤é‡å¤æ•°æ®

# ç¿»è½¬æ•°æ®æ¡†
# Excelè½¬ç½®é€‰é¡¹
# R
new.data <- t(data) # è¡Œåˆ—ç¿»è½¬
?rev
rev() # ç”¨äºå‘é‡/æ•°æ®æ¡†
data[rev(rownames(data)),] # å•ç¿»è½¬è¡Œï¼Œæ¯”å¦‚1->10å˜æˆ10->1
# e.g.
women # æ•°æ®é›†
rownames(women) #åˆ—å‡ºè¡Œå
rev(rownames(women)) # å¯¹è¡Œåè¿›è¡Œç¿»è½¬
women[rev(rownames(women)),] # åˆ—ä¸å˜ï¼Œå¯¹è¡Œè¿›è¡Œç¿»è½¬

# ä¿®æ”¹æ•°æ®åº“ä¸­çš„å€¼
# åˆ—è¿ç®—
new.data <- data.frame(c1 = data$c1 * 2, c2 = data$c2) # ç»„æˆä¸€ä¸ªæ–°çš„æ•°æ®æ¡†
transform(data, c1 = c1 * 2) # ç›´æ¥ä¿®æ”¹åŸæ•°æ®
transform(data, c3 = c1 * 2) # åœ¨åŸæ•°æ®ä¸ŠåŠ ä¸€åˆ—æ–°æ•°æ®

# å‘é‡çš„æ’åº->
?sort
sort(data) # æ•°å­—ä»å°åˆ°å¤§ï¼Œå­—ç¬¦ä»aåˆ°zï¼ˆåªèƒ½ç”¨äºå‘é‡ï¼Œä¸èƒ½ç”¨äºæ•°æ®æ¡†ï¼‰
rev(sort(data)) # æŒ‰ç…§ç›¸åæ–¹å‘æ’åº
data[sort(rownames(data)),] # ç”¨sortæ¥æ’åºæ•°æ®æ¡†çš„æ–¹æ³•ï¼ˆè¾“å‡ºæ–°æ•°æ®æ¡†ï¼‰

# æ•°æ®æ¡†çš„æ’åº-> é€šè¿‡å¯¹è¡Œå’Œåˆ—åˆ†åˆ«æ’åºï¼Œå†é€šè¿‡ç´¢å¼•è¾¾åˆ°å…±åŒæ’åº
data[sort(rownames(data)),] # å±•ç¤ºå‡ºæŒ‰ç…§åˆ—æ’åºåçš„æ•°æ®é›†
# e.g. mtcars[sort(rownames(mtcars)),]
?order
order() # è¿”å›ç´¢å¼•å€¼, å³å‘é‡å…ƒç´ åœ¨æ’åºåæ‰€åœ¨çš„ä½ç½®ï¼Œè€Œéæœ€åç»“æœ
data[order(data$target),] # æŒ‰ç…§targetåˆ—ä»å°åˆ°å¤§æ’åˆ—
data[order(-data$target),] # æŒ‰ç…§targetåˆ—ä»å¤§åˆ°å°æ’åˆ—
data[order(data$t1, data$t2),] # ä¸¤ä¸ªæ’åºæ¡ä»¶
# e.g.
mtcars$mpg
order(mtcars$mpg) # è¿”å›å‘é‡å…ƒç´ åœ¨æ’åºåæ‰€åœ¨çš„ä½ç½®
mtcars[order(mtcars$mpg),] # è¿”å›æ•°æ®æ¡†mtcarsæŒ‰ç…§mpgåˆ—ä»å°åˆ°å¤§æ’åˆ—åçš„ç»“æœ
mtcars[order(-mtcars$mpg),] # è¿”å›æ•°æ®æ¡†mtcarsæŒ‰ç…§mpgåˆ—ä»å¤§åˆ°å°æ’åˆ—åçš„ç»“æœ

?rank
rank() # æ±‚ç§©

# æ•°æ®æ¡†æ•°å­¦è¿ç®—->
WorldPhones
wordphone <- as.data.frame(WorldPhones) # å°†çŸ©é˜µè½¬åŒ–ä¸ºæ•°æ®æ¡†
rs <- rowSums(wordphone) # è®¡ç®—æ•°æ®æ¡†ä¸­æ¯å¹´æ€»æ•°ï¼Œå³æ±‚è¡Œå’Œ
cm <- colMeans(wordphone) # è®¡ç®—æ•°æ®æ¡†ä¸­æ¯åˆ—å¹³å‡æ•°ï¼Œå³æ±‚åˆ—å¹³å‡
total <- cbind(wordphone,Total=rs) # å°†è¡Œæ€»å’Œæ·»åŠ åˆ°æœ€ååˆ—ï¼Œè¾“å‡ºæ•´ä¸ªæ•°æ®æ¡†
rbind(tatal,cm) # å°†å¹³å‡å€¼æ·»åŠ åˆ°æœ€åä¸€è¡Œï¼Œä½†æ˜¯ä¼šå‡ºç°æœ€åä¸€è¡Œæœ€åä¸€åˆ—è¢«é‡å¤è®¡ç®—
# ç”¨applyç³»åˆ—å‡½æ•°è§£å†³æœ€åé‡å¤é—®é¢˜



# for dataframe, matrixï¼Œæ•°ç»„
?apply
apply(data, MARGIN = 1, FUN = sum) # è¡Œ
apply(data, MARGIN = 2, FUN = mean) # åˆ—
# e.g.
apply(WorldPhones, MARGIN = 1, FUN = sum) # å¯¹è¡Œæ±‚å’Œ
apply(WorldPhones, MARGIN = 2, FUN = mean) # å¯¹åˆ—æ±‚å¹³å‡å€¼
apply(WorldPhones, MARGIN = 2, FUN = var) # å¯¹åˆ—æ±‚æ–¹å·®
apply(WorldPhones, MARGIN = 2, FUN = log) # å¯¹åˆ—æ±‚å¯¹æ•°

?lapply
lapply(list, FUN = length) # for list(åˆ—è¡¨)ï¼Œè¿”å›é›†åˆä¸­å…ƒç´ ä¸ªæ•°
sapply() # for vector, matrixï¼Œä»¥å‘é‡å½¢å¼è¿”å›é›†åˆä¸­å…ƒç´ ä¸ªæ•°
tapply(data1, data2, FUN = length) # for factor
# e.g.
state.center # åˆ—è¡¨
class(state.center) # è¯†åˆ«æ•°æ®ç±»å‹
lapply(state.center, FUN = length) # è¿”å›æ¯ä¸ªé›†åˆä¸­çš„å€¼
class(lapply(state.center, FUN = length)) # è¯†åˆ«æ•°æ®ç±»å‹
sapply(state.center, FUN = length) # ä»¥å‘é‡å½¢å¼è¿”å›é›†åˆä¸­å…ƒç´ ä¸ªæ•°
class(sapply(state.center, FUN = length)) # è¯†åˆ«æ•°æ®ç±»å‹

?tapply # å¤„ç†å› å­æ•°æ®ï¼Œæ ¹æ®å› å­è¿›è¡Œåˆ†ç»„ï¼Œè€Œååˆ†ç»„å¤„ç†

# e.g.
state.name # ç¾å›½50ä¸ªå·å
state.division # ç¾å›½50ä¸ªå·çš„åˆ†åŒº
tapply(state.name, state.division, FUN = length) # ç»Ÿè®¡æ¯ä¸ªå¤§åŒºåŒ…å«å·æ•°é‡
# tapplyä¸­ç¬¬äºŒé¡¹æœ€é‡è¦ä¸ºå› å­åˆ†ç»„ä¾æ®

# applyç³»åˆ—å‡½æ•°->
# è¯¥ç³»åˆ—å‡½æ•°ä¸­æœ€é‡è¦çš„æ˜¯FUN,å¯ä»¥è°ƒç”¨ä¸åŒå‡½æ•°æ¥å¤„ç†é—®é¢˜

# åˆ†ç»„è®¡ç®—
tapply() # å‚æ•°ï¼švector / è¿”å›å€¼ï¼švector
apply() # å‚æ•°ï¼šlist, data.frame, array / è¿”å›å€¼ï¼švector, matrix

# å¤šå‚æ•°è®¡ç®—
mapply() # å‚æ•°ï¼švectorï¼Œä¸é™ä¸ªæ•° / è¿”å›å€¼ï¼švector, matrix

# å¾ªç¯è¿­ä»£
lapply() # å‚æ•°ï¼šlist, data.frame / è¿”å›å€¼: list
# -ç®€åŒ–ç‰ˆ
sapply() # å‚æ•°ï¼šlist, data.frame / è¿”å›å€¼ï¼švector, matrix
# - - å¯è®¾ç½®è¿”å›å€¼
vapply() # å‚æ•°ï¼šlist, data.frame / è¿”å›å€¼ï¼švector, matrix
# -é€’å½’ç‰ˆ
rapply() # å‚æ•°ï¼šlist / è¿”å›å€¼ï¼šlist

# ç¯å¢ƒç©ºé—´éå†
eapply() # å‚æ•°ï¼šenvironment / è¿”å›å€¼ï¼šlist


# Centering and standardization ä¸­å¿ƒåŒ–ä¸æ ‡å‡†åŒ–->

# ä¸­å¿ƒåŒ–ï¼ˆæ–¹å·®ï¼‰ï¼šdata setä¸­çš„å„é¡¹æ•°æ®å‡å»data setçš„å‡å€¼
# æ ‡å‡†åŒ–ï¼ˆæ ‡å‡†å·®ï¼‰ï¼šä¸­å¿ƒåŒ–ä¹‹ååœ¨é™¤ä»¥data setçš„æ ‡å‡†å·®ï¼Œå³data setä¸­çš„å„é¡¹æ•°æ®å‡å»data setçš„å‡å€¼å†é™¤ä»¥data setçš„æ ‡å‡†å·®
# ä½¿ä¸åŒç±»å‹æ•°æ®å¤§å°æ¥è¿‘
# å…ˆä¸­å¿ƒåŒ–ï¼Œæ•°æ®å·®è¿˜æ˜¯å¤§çš„è¯å†æ ‡å‡†åŒ–
# ä¸­å¿ƒåŒ–ï¼š
x - mean(x)
# æ ‡å‡†åŒ–ï¼š
(x - mean(x)) / sd(x) # sd() # æ ‡å‡†å·®

?scale
scale(x, center = T/F, scale = T/F)
# å‚æ•°center = Tä¸ºä¸­å¿ƒåŒ–å¤„ç†
# å‚æ•°scale = Tä¸ºæ ‡å‡†åŒ–å¤„ç†
# xå¯ç›´æ¥è®¾ç½®ä¸ºæ•°æ®é›†å
head() # å¤„ç†å®Œä¹‹åæµè§ˆå¤„ç†ç»“æœ
# e.g.
x <- scale(state.x77, center = T, scale = T) # ä¸­å¿ƒåŒ–å’Œæ ‡å‡†åŒ–å¤„ç†
head(x) # æŸ¥çœ‹å¤„ç†ç»“æœ
head(state.x77) # æŸ¥çœ‹åŸæ•°æ®é›†ï¼Œå¯å¯¹æ¯”
heatmap(x) # æŸ¥çœ‹çƒ­å›¾
# ä¸­å¿ƒåŒ–å’Œæ ‡å‡†åŒ–åï¼Œç»˜åˆ¶heat mapåŒºåˆ«ä¼šæ›´åŠ æ˜æ˜¾


# reshape2åŒ…->
x <- data.frame(k1 = c(NA,NA,3,4,5), k2 = c(1,NA,NA,4,5), data = 1:5)
y <- data.frame(k1 = c(NA,2,NA,4,5), k2 = c(NA,NA,3,4,5), data = 1:5)
# cbind(x,y) rbind(x,y)ï¼Œä½¿ç”¨ä¸¤è€…åˆå¹¶ä¹‹åæ— æ³•äº†è§£æ¥è‡ªxæˆ–yçš„å…·ä½“å†…å®¹
?merge
merge(x, y, by = "k1")
merge(x, y, by = "k2")
merge(x, y, by = "k2", incomparables = T) # incomparablesè¡¨ç¤ºä¸¢æ‰NAçš„æƒ…å†µ
merge(x, y, by = c("k1", "k2"))

install.packages("reshape2")
library(reshape2)
help(package="reshape2")
?melt # å¯¹å®½æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°é•¿æ•°æ®
?dcast # å¤„ç†æ•°æ®æ¡† # è¯»å–meltç»“æœ
?acast # å°†é•¿æ•°æ®å˜ä¸ºå®½æ•°æ® # è¿”å›å‘é‡/çŸ©é˜µ/æ•°ç»„

melt(data) # å¯ä»¥æŠŠå®½æ•°æ®å˜æˆé•¿æ•°æ®ï¼Œåˆ—åå˜ä¸ºå› å­
melt(data, id.vars = ) # id.vars æ˜¯è§‚æµ‹æ’åºçš„å‚æ•°

dcast(data, month+day ~variable) # é‡é“¸æ•°æ®ï¼Œä»¥monthå’Œdayåˆ—ä¸ºæ’åº
# ï½è¡¨ç¤ºäºŒè€…ç›¸å…³è”ï¼Œä½†å¹¶ä¸ä¸€å®šç›¸ç­‰
dcast(data, month ~ variable, fun.aggregate = sum, na.rm = T)
# å•ä»¥monthä¸ºæ’åˆ—å‚æ•°ä¼šæœ‰å¾ˆå¤šè¡Œæœ‰ç›¸åŒä¼˜å…ˆå€¼
# æ‰€ä»¥fun.aggregateçš„å‡½æ•°ç”¨æ¥æŠŠæœ‰ç€ç›¸åŒmonthçš„æ•°æ®è¿è¡Œä¸€ä¸ªè®¾å®šçš„å‡½æ•°

# e.g.
airquality
head(airquality) # åˆ—å‡ºè¡Œåï¼ˆè¡¨å¤´ï¼‰
names(airquality) <- tolower(names(airquality)) # å°†è¡Œåæ”¹ä¸ºå°å†™
head(airquality) # åœ¨æ­¤æŸ¥çœ‹è¡¨å¤´
melt(airquality) # æŠŠé•¿æ•°æ®å˜ä¸ºå®½æ•°æ®,variableæ˜¯å› å­ç±»å‹
aql <- melt(airquality) # èµ‹å€¼äºaql
head(aql) # æŸ¥çœ‹aql
aql <- melt(airquality,id.vars = c("month","day")) # æ·»åŠ idå˜é‡
# è¦å‘Šè¯‰meltå‡½æ•°ï¼Œmonthå’Œdayæ˜¯ä½œä¸ºIDï¼Œå…¶ä½™4ä¸ªä½œä¸ºå˜é‡å€¼ï¼ŒIDæ˜¯ç”¨äºåŒºåˆ†ä¸åŒè¡Œæ•°æ®çš„å˜é‡ï¼Œ
# è¦å‘Šè¯‰meltå‡½æ•°ï¼Œæ•°æ®ä¸­å“ªäº›ä½œä¸ºè¡Œçš„è§‚æµ‹ï¼Œå“ªäº›ä½œä¸ºåˆ—çš„è§‚æµ‹å€¼ï¼Œ
# å› æ­¤ä½¿ç”¨id.varï¼Œå°†monthå’Œdayä½œä¸ºIDå˜é‡
head(aql,50)
aqw <- dcast(aql,month+day ~variable) # å¯¹æ•°æ®è¿›è¡Œé‡é“¸
head(aqw)
aqw <- dcast(aql,month ~variable,fun.aggregate = mean,na.rm=TRUE)
# åœ¨æ²¡æœ‰dayä¹‹åï¼ŒRä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†ç›¸åŒmonthçš„å€¼ï¼Œ
# fun.aggregateç»™å®šå‡½æ•°æŒ‡å®šå¤„ç†æ–¹å¼ï¼Œe.g. sum mean var sd
# na.rmå‚æ•°å°†å­˜åœ¨çš„ç¼ºå¤±å€¼å®šä¹‰ä¸ºTRUE
head(aqw)


# tidyråŒ…ï¼ˆTidy dataï¼‰->

install.packages("tidyr")  # tidy data
library(tidyr)
help(package="tidyr") # æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£
# ä¸èƒ½æœ‰ä¸¤ä¸ªç›¸åŒè¡Œåå’Œåˆ—åçš„unit

# e.g.
mtcars
tdata <- mtcars[1:10,1:3] # é€‰å–éƒ¨åˆ†æ•°æ®
tdata <- data.frame(names=rownames(tdata),tdata) # å°†åŸæ•°æ®åˆ—åè°ƒå…¥æ•°æ®ï¼ŒåŒæ—¶åŸåˆ—åä¸å˜
tdata # æŸ¥çœ‹ç»“æœ
gather(tdata,key = "Key", value = "Value",cyl,disp,mpg)
# å®šä¹‰å˜é‡å’Œå€¼ï¼Œå¯¹cylã€dispã€mpgè¿›è¡Œå¤„ç†
gather(tdata,key = "Key", value = "Value",cyl:disp,mpg) # å°†cylå’Œdispæ”¾äºä¸€åˆ—
gather(tdata,key = "Key", value = "Value",cyl,-mpg) # æ’é™¤mpg
gather(tdata,key = "Key", value = "Value",2:4) # å¯ç›´æ¥å†™åˆ—çš„ç¼–å·ï¼Œ2-4åˆ—

gdata <- gather(tdata,key = "Key", value = "Value",2:4)
gdata
spread(gdata,key = "Key", value = "Value") # é‡æ–°å°†æ•°æ®é›†gdataå˜ä¸ºtdata


# å®½å˜é•¿
gather(data, key = "Key", value = "Value", factor1, factor2, facotr3)
# factorå…¶å®å°±æ˜¯åˆ—ï¼ŒæŠŠæ¯ä¸€åˆ—å˜æˆä¸€ç§å› å­
gather(data, key = "Key", value = "Value", 2:4) # å¯ä»¥ç›´æ¥è¾“å…¥åˆ—çš„ç¼–å·

# é•¿å˜å®½
spread(data, key = "Key", value = "Value") # gatherçš„åå‡½æ•°
# ä¼šè‡ªåŠ¨æŠŠkeyé‡Œé¢ä¸åŒçš„å› å­å˜ä¸ºä¸åŒçš„åˆ—å

# åˆ†éš”ä¸åˆå¹¶
df <- data.frame(x = c(NA, "a.b", "b.c", "a.d"))
separate(df, col = x, into = c("c1", "c2")) # ä¼šè‡ªåŠ¨è¯†åˆ«åˆ†å‰²ç¬¦
df <- data.frame(x = c(NA, "a.b-c", "b-c", "a-d")) 
separate(df, col = x, into = c("c1", "c2"), sep="-") # æœ‰å¤šä¸ªåˆ†å‰²ç¬¦ä½¿éœ€è¦æ ‡æ˜
unite(x, col = "united col", c1, c2, sep="-")
# separateçš„åå‡½æ•°ï¼ŒæŠŠä¸¤åˆ—è¿èµ·æ¥ï¼Œéœ€è¡¨æ˜è¿ç½®ç¬¦

# e.g. 
df <- data.frame(x = c(NA, "a.b", "b.c", "a.d"))
separate(df, col = x, into = c("A", "B")) # ä¼šè‡ªåŠ¨è¯†åˆ«åˆ†å‰²ç¬¦
df <- data.frame(x = c(NA, "a.b-c", "b-c", "a-d"))
df
separate(df, col = x, into = c("A", "B"), sep="-") # æœ‰å¤šä¸ªåˆ†å‰²ç¬¦ä½¿éœ€è¦æ ‡æ˜
x <- separate(df, col = x, into = c("A", "B"), sep="-") # èµ‹å€¼äºx
x # æŸ¥çœ‹x
unite(x, col = "AB", A, B, sep="-") # é‡æ–°è¿èµ·æ¥ï¼Œåˆå¹¶




# dplyråŒ…->
install.packages("dplyr")
library(dplyr)
ls("package:dplyr")
help(package="dplyr")

dplyr::filter(data, c2 > 10) # filteræ‰ä¸ç¬¦åˆåé¢é€»è¾‘çš„è¡Œ

dplyr::distinct(rbind(data[1:10,], data[1:15,])) # distinctå»æ‰é‡å¤çš„åè¡Œ

dplyr::slice(data, 10:15) # å–å‡ºåˆ¶å®šè¡Œ

dplyr::sample_n(data, n) # éšæœºå–å‡ºnè¡Œ
dplyr::sample_frac(data, 0.1) # æŒ‰å‡ ç‡å–å‡ºè¡Œ

dplyr::arrange(data, c2) # æŒ‰ç…§æŸä¸€åˆ—çš„å¤§å°æ¥æ’åºï¼ˆä»å°åˆ°å¤§ï¼‰
dplyr::arrange(data, desc(c2)) # æŒ‰ç…§æŸä¸€åˆ—ç›¸åçš„å¤§å°æ¥æ’åºï¼ˆä»å¤§åˆ°å°ï¼‰

?select
select() # å¯¹æ•°æ®æ¡†å–å­é›†

# e.g.
iris
dplyr::filter(iris,Sepal.Length>7) # è¿‡æ»¤èŠ±è¼é•¿åº¦<7çš„æ•°æ®ï¼Œå¯é€‰å®šç‰¹å®šè¡Œè¿›è¡Œè¿‡æ»¤
# ä¸ºé¿å…dplyrä¸­å‘½ä»¤ä¸å…¶ä»–åŒ…çš„å‘½ä»¤é‡å¤ï¼Œå› æ­¤ä½¿ç”¨ dplyr::å‘½ä»¤ æ¥è°ƒç”¨
dplyr::distinct(rbind(iris[1:10,],iris[1:15,])) # é€‰å®š1-10åˆ—ï¼Œ1-15è¡Œï¼Œå»é™¤é‡å¤
dplyr::slice(iris,10:15) # é€‰å‡ºç‰¹å®šè¡Œ
dplyr::sample_n(iris,10) # éšæœºæŠ½å–10è¡Œ
dplyr::sample_frac(iris,0.1) # æŒ‰æ¯”ä¾‹éšæœºé€‰å–
dplyr::arrange(iris, Sepal.Length) # æŒ‰ç…§èŠ±è¼é•¿åº¦è¿›è¡Œæ’åº
dplyr::arrange(iris, desc(Sepal.Length)) # æŒ‰ç…§èŠ±è¼é•¿åº¦è¿›è¡Œé€†å‘æ’åº


# ç»Ÿè®¡å‡½æ•°
summarise(data, avg = mean(c2)) # è®¡ç®—å¹³å‡é•¿åº¦
summarise(data, sum = sum(c2)) # è®¡ç®—æ€»é•¿åº¦
# e.g.
summarise(iris,avg=mean(Sepal.Length)) # è®¡ç®—èŠ±è¼çš„å¹³å‡é•¿åº¦
summarise(iris,avg=sum(Sepal.Length)) # è®¡ç®—èŠ±è¼çš„æ€»é•¿åº¦

# é“¾å¼æ“ä½œç¬¦ %>%ï¼ˆç®¡é“ï¼‰
# ç”¨äºå®ç°å°†ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ã€‚
# å¿«æ·é”®ï¼šctrl + shift + M
# ç›¸å½“äºâ€œç„¶åâ€
# ä¾‹å­ï¼š
head(data, 20) # å–å‡ºdataçš„å‰20è¡Œ
head(data, 20) %>% tail(10)
# å…ˆå–å‡ºdataçš„å‰äºŒåè¡Œï¼Œå†ä»è¿™äºŒåè¡Œé‡Œé¢å–å‡ºæœ€åçš„åè¡Œï¼Œæ‰€ä»¥æœ€ç»ˆè¾“å‡ºä¸º11-20è¡Œã€‚

dplyr::group_by(data, c5) # é€šè¿‡åˆ¶å®šåˆ—çš„å› å­æ¥è¿›è¡Œåˆ†ç»„ï¼Œæ¯ä¸€ç§å› å­ä¸ºä¸€ç»„ã€‚
data %>% group_by(c5) # å¦ä¸€ç§å†™æ³•
data %>% group_by(c5) %>% summarise(avg = mean(c2)) %>% arrange((avg))
# å…ˆåˆ†ç»„ï¼Œå†ç®—å¹³å‡å€¼ï¼Œå†æ’åº
# e.g.
dplyr::group_by(iris, Species) # é€šè¿‡Specieså¯¹irisè¿›è¡Œåˆ†ç»„
iris %>% group_by(Species) # é€šè¿‡ç®¡é“åˆ†ç»„ï¼Œç»“æœåŒä¸Š
iris %>% group_by(Species) %>% summarise() # åˆ†ç»„ç»Ÿè®¡
iris %>% group_by(Species) %>% summarise(avg = mean(Sepal.Width)) # åˆ†ç»„ä¹‹åè®¡ç®—å‡å€¼
iris %>% group_by(Species) %>% summarise(avg = mean(Sepal.Width)) %>% arrange((avg))
# å…ˆåˆ†ç»„ï¼Œå†ç®—å¹³å‡å€¼ï¼Œå†æ’åº

dplyr::mutate(data, new=c2+c3) # åŠ æ–°çš„ä¸€åˆ—ï¼Œå¹¶æ·»åŠ é€»è¾‘

# åŒè¡¨æ ¼æ•´åˆ

a <- data.frame(x1 = c("A","B","C"), x2 = c(1,2,3))
a
b <- data.frame(x1 = c("A","B","D"), x2 = c(T,F,T))
b
dplyr::left_join(a, b, by="x1") # x1ä»¥ç¬¬ä¸€ä¸ªæ•°æ®æ¡†ä¸ºå‡†
#   x1 x2.x  x2.y
# 1  A    1  TRUE
# 2  B    2 FALSE
# 3  C    3    NA
dplyr::right_join(a, b, by="x1") # x1ä»¥ç¬¬äºŒä¸ªæ•°æ®æ¡†ä¸ºå‡†
#   x1 x2.x  x2.y
# 1  A    1  TRUE
# 2  B    2 FALSE
# 3  D   NA  TRUE   # å› ä¸ºaçš„x1æ²¡æœ‰Dï¼Œæ‰€ä»¥x2.xæ˜¯NA
dplyr::full_join(a, b, by="x1") # å…¨è”æ¥ # æŠŠæ‰€æœ‰å¯èƒ½éƒ½åˆ—å‡ºæ¥äº†
#   x1 x2.x  x2.y
# 1  A    1  TRUE
# 2  B    2 FALSE
# 3  C    3    NA
# 4  D   NA  TRUE
dplyr::semi_join(a, b, by="x1") # åŠè”æ¥ # æ ¹æ®å³ä¾§è¡¨å†…å®¹å¯¹å·¦ä¾§è¡¨è¿›è¡Œè¿‡æ»¤ï¼Œåˆ—å‡ºäº¤é›†
#   x1 x2
# 1  A  1
# 2  B  2
dplyr::anti_join(a, b, by="x1") # åè”æ¥ # åˆ—å‡ºaï¼Œbçš„ä¸åŒè¡Œ
#   x1 x2
# 1  C  3

# å¤šä¸ªæ•°æ®é›†çš„åˆå¹¶

intersect(data1, data2) # å–äº¤é›†
dplyr::union_all(data1, data2) # å–å¹¶é›†
dplyr::union(data1, data2) # å–éå†—ä½™çš„å¹¶é›†
setdiff(data1, data2) # å–data1çš„è¡¥é›†

# e.g.
mtcars
first <- slice(mtcars,1:20) #å–å‡ºmtcarsæ•°æ®é›†çš„å‰20è¡Œ
# mtcars <- mutate(mtcars,Model=rownames(mtcars)) # ä¸ºæ•°æ®é›†æ·»åŠ ä¸€åˆ—
second <- slice(mtcars,10:30)
first
second
intersect(first, second) # å–äº¤é›†
dplyr::union_all(first, second) # å–å¹¶é›†
dplyr::union(first, second) # å–éå†—ä½™çš„å¹¶é›†
setdiff(first, second) # å–firstçš„è¡¥é›†


# P41     Rå‡½æ•°-----------------------------------------------------------------

# ä¾‹å­ï¼š
state <- as.data.frame(state.x77[, c("Murder", "Population", "Illiteracy", "Income", "Frost")])
# å°†state.x77è½¬ä¸ºæ•°æ®æ¡†
class(state.x77)
class(state)
fit <- lm(Murder ~ Population + Illiteracy + Income + Frost, data = state)
# ä½¿ç”¨lmå‡½æ•°è¿›è¡Œå›å½’åˆ†æ
summary(fit)

# å‡½æ•°çš„è¿”å›å€¼
# ä¸€äº›æœ‰è¿”å›ï¼Œä¸€äº›æ²¡æœ‰

# ç»˜å›¾å‡½æ•°è¾“å‡ºå›¾å½¢ï¼Œéœ€è¦æŒ‡å®šç»˜å›¾è®¾å¤‡ï¼Œå°†ç»“æœè¾“å‡ºæŒ‡å®šè®¾å¤‡ä¸­

# å‘é‡
sum()
mean()
sd()
range()
median()
sort()
order()

# çŸ©é˜µæˆ–æ•°æ®æ¡†
rbind()
cbind()

# æ•°å­—çŸ©é˜µ
heatmap()

# å¯ä»¥ä½¿ç”¨help()æ¥çœ‹ä¸æ‡‚çš„å‡½æ•°


# P42     é€‰é¡¹å‚æ•°--------------------------------------------------------------

ls("package:base")
par()

# è§„å¾‹

# 1. è¾“å…¥æ§åˆ¶éƒ¨åˆ†
# å¯ä»¥æ¥æ”¶å“ªç§ç±»å‹çš„æ•°æ®
# fileï¼šæ¥ä¸€ä¸ªæ–‡ä»¶
# dataï¼šä¸€èˆ¬æŒ‡è¦è¾“å…¥ä¸€ä¸ªæ•°æ®æ¡†
# xï¼šä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯å‘é‡ï¼Œ  ä½†ä¹Ÿå¯èƒ½æ˜¯çŸ©é˜µæˆ–è€…åˆ—è¡¨
# xå’Œyï¼šå‡½æ•°éœ€è¦ä¸¤ä¸ªè¾“å…¥å˜é‡
# x, y, zï¼šå‡½æ•°éœ€è¦ä¸‰ä¸ªè¾“å…¥å˜é‡
# formulaï¼šå…¬å¼
# na.rmï¼šæ˜¯å¦åˆ é™¤ç¼ºå¤±å€¼
# ...è¡¨ç¤ºå‚æ•°å¯ä¼ é€’ï¼Œæˆ–æ²¡æœ‰æ•°é‡é™åˆ¶
# ~ è¡¨ç¤ºç›¸å…³

# 2. è¾“å‡ºæ§åˆ¶éƒ¨åˆ†

# 3. è°ƒèŠ‚éƒ¨åˆ†
# ï¼ˆ1ï¼‰æ ¹æ®åå­—åˆ¤æ–­é€‰é¡¹çš„ä½œç”¨ï¼š
# coloré€‰é¡¹ï¼šæ§åˆ¶é¢œè‰²
# select ä¸é€‰æ‹©æœ‰å…³
# font ä¸å­—ä½“æœ‰å…³
# font.axis åæ ‡è½´çš„å­—ä½“
# lty = line type # çº¿å‹
# lwd = line width # çº¿å®½
# method è½¯ä»¶ç®—æ³•
# ï¼ˆ2ï¼‰é€‰é¡¹æ¥å—å“ªäº›å‚æ•°ï¼š
# mainï¼šå­—ç¬¦ä¸²ï¼Œä¸èƒ½æ˜¯å‘é‡
# na.rmï¼šTRUE or FALSE
# axisï¼šsideå‚æ•°åªèƒ½æ˜¯1åˆ°4
# figï¼šåŒ…å«å››ä¸ªå…ƒç´ çš„å‘é‡
# ä¸å–å€¼å¯èƒ½æ˜¯NULLæˆ–è€…NA
# methodå‚æ•°ä¸ç®—æ³•ç›¸å…³


# P43     æ•°å­¦ç»Ÿè®¡å‡½æ•°----------------------------------------------------------

# æ¦‚ç‡å‡½æ•°

# Ræ¦‚ç‡åˆ†å¸ƒ
# d æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆdensityï¼‰
# p åˆ†å¸ƒå‡½æ•°ï¼ˆdistributionï¼‰
# q åˆ†å¸ƒå‡½æ•°çš„åå‡½æ•°ï¼ˆquantumï¼Ÿï¼‰
# r äº§ç”Ÿç›¸åŒåˆ†å¸ƒçš„éšæœºæ•°ï¼ˆrandomï¼‰

# æ­£æ€åˆ†å¸ƒ
?Normal
dnorm()
pnorm()
qnorm()
rnorm()

# ç¦»æ•£åˆ†å¸ƒ

# åˆ†å¸ƒçš„ä½œç”¨
x <- rnorm(n=100, mean=15, sd=2) # ç”Ÿæˆæ­£æ€åˆ†å¸ƒ
qqnorm(x) # ç”Ÿæˆæ­£æ€åˆ†å¸ƒå›¾

?Geometric  # å‡ ä½•åˆ†å¸ƒ
?Hypergeometric # è¶…å‡ ä½•åˆ†å¸ƒ

# å¯¹åˆ†å¸ƒè¿›è¡Œæ£€éªŒ

# ç”Ÿäº§éšæœºæ•°
?runif
runif(n) # ç”Ÿäº§nä¸ª0-1çš„éšæœºæ•°
runif(n, min = 1, max = 100) # min/maxå‚æ•°è®¾ç½®èŒƒå›´
round(runif(n, min = 1, max = 100)) # ä½¿ç”¨roundç”Ÿæˆæ•´æ•°
dgamma(c(1:9),shape = 2,rate = 1) # ç”Ÿæˆgammaåˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦

# éšæœºæ•°ç§å­
set.seed(n) # æ¯æ¬¡è¿è¡Œå¯ä»¥ä½¿ä¹‹åçš„éšæœºæ•°ç›¸åŒï¼Œnä¸ºç§å­ç¼–ç 


# P44     æè¿°æ€§ç»Ÿè®¡å‡½æ•°--------------------------------------------------------

# summary()æä¾›å‘é‡çš„å„é¡¹æ•°æ®ï¼Œæ¯”å¦‚æœ€å¤§å°å€¼ã€å¹³å‡å€¼ã€å››åˆ†ä½æ•°ã€å› å­é¢‘æ•°å‘é‡ç»Ÿè®¡ç­‰
myvars <- mtcars[c("mpg", "hp", "wt", "am")]
summary(myvars)

fivenum(myvars$hp)
# è¿”å›äº”ä¸ªæ•°ï¼šæœ€å°å€¼ã€å››åˆ†ä½æ•°ç¬¬ä¸€ã€ä¸­ä½æ•°ã€å››åˆ†ä½æ•°ç¬¬ä¸‰ã€æœ€å¤§å€¼

# Descriptive stats via describe (Hmisc)
install.packages("Hmisc")
library(Hmisc)
myvars <- c("mpg", "hp", "wt")
describe(mtcars)
describe(mtcars[myvars])

# Descriptive stats via stat.desc (pastecs)
install.packages("pastecs")
library(pastecs)
stat.desc(myvars)
stat.desc(mtcars[myvars])
stat.desc(mtcars, basic = T, desc = T, norm = T)
# basic = T è®¡ç®—åŸºæœ¬å€¼
# desc = T è®¡ç®—æè¿°å€¼
# norm = T è®¡ç®—ç»Ÿè®¡å€¼

# Descriptive stats via describe (psych) 
install.packages("psych")
library(psych)
describe(mtcars)
describe(mtcars[myvars], trim = 0.1)
# trim = 0.1 å»é™¤æœ€ä½10%å’Œæœ€é«˜10%çš„æ•°æ®
?describe
Hmisc::describe(mtcars)
# å‡½æ•°é¡ºåºï¼šåå…¥ä¸ºä¸»ï¼ˆåé¢è½½å…¥çš„åŒ…å‡½æ•°ä¼šè¦†ç›–å‰é¢çš„åŒ…å‡½æ•°ï¼‰
# ç”¨::æ¥è¡¨æ˜å‡½æ•°æ¥æº

# Descriptive stats by group with aggregate
library(MASS)
aggregate() # æ¯æ¬¡åªèƒ½ç”¨ä¸€ä¸ªç»Ÿè®¡å‡½æ•°
# e.g.
?Cars93
head(Cars93) # æ•°æ®ç¬¬ä¸€åˆ—ä¸ºå­—ç¬¦å‹å‘é‡ï¼Œæ— æ³•è®¡ç®—è¦å‰”é™¤
Cars93[c("Min.Price","Price","Max.Price","MPG.city")]
aggregate(Cars93[c("Min.Price","Price","Max.Price","MPG.city")],
          by = list(Manufacturer=Cars93$Manufacturer),mean)
# å¯¹æ¯ä¸ªæ±½è½¦åˆ¶é€ å•†äº§å“ä»·æ ¼è¿›è¡Œç»Ÿè®¡
aggregate(Cars93[c("Min.Price","Price","Max.Price","MPG.city")],
          by = list(Cars93$Origin),mean)
# å¯¹æ˜¯å¦ä¸ºå›½äº§æ±½è½¦è¿›è¡Œä»·æ ¼ç»Ÿè®¡
aggregate(Cars93[c("Min.Price","Price","Max.Price","MPG.city")],
          by = list(Cars93$Origin),sd)
aggregate(Cars93[c("Min.Price","Price","Max.Price","MPG.city")],
          by = list(Cars93$Origin,Manufacturer=Cars93$Manufacturer),mean)
# å¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ªåˆ†ç»„


# Descriptive stats by group via summaryBy
install.packages("doBy")
library(doBy)
?summaryBy
# åŒæ—¶å±•ç¤ºå¤šä¸ªç»Ÿè®¡ç»“æœ
summaryBy(mpg+hp+wt ~ am, data=mtcars, FUN=mystats)
# ä¸åŒå˜é‡ä¹‹é—´ç”¨+ï¼Œï½å³ä¾§ä¸ºç±»åˆ«å‹çš„åˆ†ç»„å˜é‡ï¼ŒdataæŒ‡å®šå‚æ•°é›†ï¼ŒFUNå‚æ•°æŒ‡å®šå‡½æ•°
summaryBy(mpg+hp+wt ~ am, data=mtcars, FUN=mean)

# Descriptive stats by group via describe.by (psych)
library(psych)
# è®¡ç®—åˆ†ç»„ç»Ÿè®¡é‡
describeBy(mtcars[myvars], list(am=mtcars$am)) 
# æ·»åŠ åˆ†ç»„åˆ—è¡¨ï¼Œç»™å®šlistå³å¯
# ç»™å‡ºçš„ç»Ÿè®¡å€¼æ˜¯å›ºå®šçš„ï¼Œæ²¡åŠæ³•ä½¿ç”¨è‡ªå®šä¹‰çš„å‡½æ•°
describeBy(mtcars, list(am=mtcars$am)) 


# P45     é¢‘æ•°ç»Ÿè®¡å‡½æ•°----------------------------------------------------------

# frequency table
mtcars
mtcars$cyl <- as.factor(mtcars$cyl) # å°†mtcars$cylè¯¥åˆ—è½¬åŒ–ä¸ºå› å­
split(mtcars, mtcars$cyl) # æŒ‰ç…§å› å­è¿›è¡Œåˆ†ç»„
split(mtcars, as.factor(mtcars$cyl)) # ç›´æ¥ä»¥cylçš„å› å­åˆ†ç±»

cut(mtcars$mpg, c(seq(10, 50, 10))) # æœ€åä¸€ä¸ªæ•°ä¸ºé—´éš”æ•°ï¼ˆ10-20ï¼Œ20-30ï¼Œ30-40ï¼Œ40-50ï¼‰

?table
table(mtcars$cyl) # é¢‘æ•°çš„ç»Ÿè®¡,å¯ç›´æ¥åŠ å…¥å› å­
table(cut(mtcars$mpg, c(seq(10, 50, 10)))) # å¯ç›´æ¥åŠ å…¥åˆ†å‰²ç»“æœ
prop.table(table(mtcars$cyl)) # è®¡ç®—æ¯ç§å› å­çš„æ¯”ä¾‹

# äºŒç»´æ•°æ®æ¡†
library(vcd)
table(Arthritis$Treatment, Arthritis$Improved) # ç»Ÿè®¡äºŒè€…é¢‘ç‡
with(data=Arthritis, table(Treatment, Improved))
? xtabs
x <- xtabs(~ Treatment + Improved, data = Arthritis)
# è¡¨ç¤ºæ ¹æ®Treatment + Improvedä¸¤ä¸ªå‚æ•°è¿›è¡Œè®¡ç®—ï¼Œdataé€‰é¡¹ä¸ºæ•°æ®é›†

margin.table(x) # ç»Ÿè®¡x
margin.table(x, 1)
prop.table(x, 1) # ç»Ÿè®¡é¢‘ç‡
addmargins(x) # å°†ç¼–è¾‘çš„å’Œæ·»åŠ åˆ°é¢‘æ•°è¡¨ä¸­
addmargins(xï¼Œ1)
# 1 = åªæ·»åŠ è¡Œ
# 2 = åªæ·»åŠ åˆ—


# ä¸‰ç»´
y <- xtabs(~ Treatment + Improved + Sex, data = Arthritis)
y
ftable(y) # å¹³é“ºå¼çš„åˆ—è”è¡¨



# P46     ç‹¬ç«‹æ€§æ£€éªŒå‡½æ•°--------------------------------------------------------

# æ ¹æ®é¢‘æ•°ä¿¡æ¯ï¼Œåˆ¤æ–­ä¸¤ç±»å› å­ï¼Œå½¼æ­¤ç›¸å…³æˆ–ç›¸äº’ç‹¬ç«‹çš„å‡è®¾æ£€éªŒ
# ç‹¬ç«‹æ€§ï¼šå˜é‡ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰å…³ç³»

# p-value (probability)ï¼šåœ¨åŸå‡è®¾ä¸ºçœŸæ—¶ï¼Œå¾—åˆ°æœ€å¤§çš„æˆ–è€…è¶…å‡ºæ‰€å¾—åˆ°çš„æ£€éªŒç»Ÿè®¡é‡å€¼çš„æ¦‚ç‡ã€‚
# åŸå‡è®¾ï¼šæ²¡æœ‰å‘ç”Ÿ / å¤‡æ‹©å‡è®¾ï¼šå‘ç”Ÿäº†
# ä¸€èˆ¬å°†på€¼å®šä½åˆ°0.05ï¼Œå½“p<0.05æ‹’ç»åŸå‡è®¾ï¼ˆä¸é è°±ï¼‰ï¼Œå½“p>0.05ä¸æ‹’ç»åŸå‡è®¾ï¼ˆé è°±ï¼‰ã€‚
# på€¼è®¾å®šçš„è¶Šå°ï¼Œè¶Šç²¾ç¡®ã€‚
# è®¡ç®—å‡ºçš„på€¼è¶Šå°è¶Šå¥½

# å¡æ–¹æ£€éªŒï¼ˆChi-square testï¼‰
library(vcd)
mytable <- table(Arthritis$Treatment, Arthritis$Improved) # å˜é‡çš„é¡ºåºä¸é‡è¦
?chisq.test # è¿›è¡Œå¡æ–¹ç‹¬ç«‹æ£€éªŒ
chisq.test(mytable)

# Fisher's exact test
?fisher.test
mytable <- xtabs(~Treatment+Improved, data=Arthritis) 
fisher.test(mytable)

# Cochran-Mantel-Haenszelæ£€éªŒ
?mantelhaen.test
mytable <- xtabs(~Treatment+Improved+Sex, data=Arthritis) # å˜é‡çš„é¡ºåºå¾ˆé‡è¦ï¼ˆå› ä¸ºè¦ä¸‰ä¸ªå˜é‡ï¼‰
mytable
mantelhaen.test(mytable)


# P47     ç›¸å…³æ€§åˆ†æå‡½æ•°--------------------------------------------------------

# ç›¸å…³æ€§åˆ†æï¼šå¯¹ä¸¤ä¸ªæˆ–å¤šä¸ªå…·å¤‡ç›¸å…³æ€§çš„å˜é‡å…ƒç´ è¿›è¡Œåˆ†æï¼Œä»è€Œè¡¡é‡ä¸¤ä¸ªå˜é‡å› ç´ çš„ç›¸å…³å¯†åˆ‡ç¨‹åº¦ã€‚
# ç›¸å…³æ€§çš„å…ƒç´ ä¹‹é—´éœ€è¦å­˜åœ¨ä¸€å®šçš„è”ç³»æˆ–è€…æ¦‚ç‡æ‰å¯ä»¥è¿›è¡Œç›¸å…³æ€§åˆ†æï¼ˆå˜é‡ä¹‹é—´æ˜¯å¦æœ‰å…³ç³»ï¼‰

# æ­£ç›¸å…³æˆ–è´Ÿç›¸å…³ï¼ˆç›¸å…³ç³»æ•°ï¼‰
# Pearsonç›¸å…³ç³»æ•°
# Spearmanç›¸å…³ç³»æ•°
# Kendallç›¸å…³ç³»æ•°
# åç›¸å…³ç³»æ•°
# å¤šåˆ†æ ¼ï¼ˆpolychoricï¼‰ç›¸å…³ç³»æ•°
# å¤šç³»åˆ—ï¼ˆpolyserialï¼‰ç›¸å…³ç³»æ•°

# ä½¿ç”¨cor()è®¡ç®—ç›¸å…³ç³»æ•°
?cor
state.x77
?cor(state.x77) # é»˜è®¤method="pearson"
cor(state.x77, method="spearman")
# æ­£è´Ÿå·è¡¨ç¤ºæ­£ç›¸å…³æˆ–è´Ÿç›¸å…³
?cov
cov(state.x77) # åæ–¹å·®

colnames(state.x77)
x <- state.x77[, c(1,2,3,6)]
y <- state.x77[, c(4,5)]
head(x)
head(y)
cor(x, y)

# partial correlations åç›¸å…³ç³»æ•°
install.packages("ggm")
library(ggm)
# partial correlation of population(1) and murder rate(5), controlling 
# for income(2), illiteracy rate(3), and HS graduation rate(6)
colnames(state.x77)
pcor(c(1,5,2,3,6), cov(state.x77))


# P48     ç›¸å…³æ€§æ£€éªŒå‡½æ•°--------------------------------------------------------

# Testing a correlation coefficient for significance
?cor.test
cor.test(state.x77[,3], state.x77[,5])

# Confidence intervalï¼ˆç½®ä¿¡åŒºé—´ï¼‰
# æ ·æœ¬ç»Ÿè®¡é‡æ‰€æ„é€ çš„æ€»ä½“å‚æ•°çš„ä¼°è®¡åŒºé—´ï¼ˆè¢«æµ‹é‡å‚æ•°çš„æµ‹é‡å€¼çš„å¯ä¿¡ç¨‹åº¦ï¼‰
# æ¦‚ç‡å‘ç”Ÿçš„èŒƒå›´
# å±•ç°çš„æ˜¯è¿™ä¸ªå‚æ•°çš„çœŸå®å€¼æœ‰ä¸€å®šæ¦‚ç‡è½åœ¨æµ‹é‡ç»“æœçš„å‘¨å›´çš„ç¨‹åº¦ã€‚

# Correlation matrix and tests of significance via corr.test
corr.test(states, use="complete")
library(psych)
corr.test(state.x77) # ä¸ä»…ç»™å‡ºç›¸å…³ç³»æ•°ï¼Œè€Œä¸”ç»™å‡ºæ£€æµ‹å€¼
library(ggm)
?pcor.test
x <- pcor(c(1,5,2,3,6), cov(state.x77))
pcor.test(x, 3, 50) # 3 -> å˜é‡æ•°ï¼Œ50 -> æ ·æœ¬æ•°
# åˆ†åˆ«è¾“å‡ºï¼šå­¦ä¼šè¯´å‘¢ç»™çš„tæ£€éªŒã€è‡ªç”±åº¦ã€p-value


# Two Sample  t-test
library(MASS)
?t.test
UScrime
?UScrime
t.test(Prob ~ So, data=UScrime)
t.test(y ~ x, data = )

# éå‚æ•°æ£€éªŒï¼ˆNonparametric testï¼‰ï¼šåœ¨æ€»ä½“æ–¹å·®æœªçŸ¥æˆ–çŸ¥é“ç”šå°‘çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨æ ·æœ¬å¯¹æ€»ä½“åˆ†å¸ƒå½¢æ€ç­‰è¿›è¡Œæ¨æ–­çš„æ–¹æ³•ã€‚
# å‚æ•°æ£€éªŒï¼ˆParametric testï¼‰:æ€»ä½“åˆ†å¸ƒå½¢å¼å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œå¯¹æ€»ä½“åˆ†å¸ƒçš„å‚æ•°ï¼ˆå¦‚å‡å€¼ã€æ–¹å·®ç­‰ï¼‰è¿›è¡Œæ¨æ–­çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯æ•°æ®åˆ†å¸ƒå·²çŸ¥ï¼Œæ¯”å¦‚æ»¡è¶³æ­£æ€åˆ†å¸ƒã€‚

# dependent t test
sapply(UScrime[c("U1", "U2")], function(x)(c(mean=mean(x), sd=sd(x))))
with(UScrime, t.test(U1, U2, paired=T))



# P49     ç»˜å›¾å‡½æ•°--------------------------------------------------------------

# 1. RåŸºç¡€ç»˜å›¾ç³»ç»Ÿ
ls("package:graphics")
demo(graphics) # å±•ç¤ºå‡ºRä¸­èƒ½ç»˜åˆ¶çš„å›¾
help(package=graphics)
# ï¼ˆ1ï¼‰é«˜çº§ç»˜å›¾ï¼šä¸€æ­¥åˆ°ä½ï¼Œç›´æ¥ç»˜åˆ¶å‡ºå›¾
# ï¼ˆ2ï¼‰ä½çº§ç»˜å›¾ï¼šä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¾—åœ¨é«˜çº§ç»˜å›¾äº§ç”Ÿå›¾å½¢çš„åŸºç¡€ä¸Šï¼Œå¯¹å›¾å½¢è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚åŠ çº¿ã€æ ‡é¢˜æ–‡å­—ç­‰
# çŸ¥é“è¾“å…¥æ•°æ®çš„æ ¼å¼å¾ˆé‡è¦ï¼š
# æ•£ç‚¹å›¾ï¼šxå’Œyä¸¤ä¸ªåæ ‡æ•°æ®
# ç›´æ–¹å›¾ğŸ“Šï¼šå› å­
# çƒ­åŠ›å›¾ï¼šæ•°æ®çŸ©é˜µ
plot(women$height)
plot(women$height, women$weight)
plot(as.factor(women$height)) # ç»˜åˆ¶ç›´æ–¹å›¾

plot(as.factor(mtcars$cyl)) # ç›´æ–¹å›¾
plot(mtcars$cyl) # æ•£ç‚¹å›¾
plot(as.factor(mtcars$cyl), mtcars$carb) # ç®±çº¿å›¾
plot(mtcars$carb, as.factor(mtcars$cyl)) # æ•£åˆ—å›¾
plot(as.factor(mtcars$cyl), as.factor(mtcars$carb)) # è„ŠæŸ±å›¾

plot(women$height ~ women$weight) # å¦ä¸€ç§å†™æ³•

fit <-lm(height ~ weight, data=women)
plot(fit) # plotä¼šè‡ªåŠ¨æ£€æµ‹è¾“å…¥çš„æ•°æ®ç±»å‹æ¥è¿›è¡Œä¸åŒçš„ç»˜å›¾


# S3ç³»ç»Ÿï¼ˆé¢å‘å¯¹è±¡ï¼‰ï¼šå±æ€§ï¼Œæ³›å‹å‡½æ•°ï¼Œæ–¹æ³•
methods(plot) # æŸ¥çœ‹plotçš„å†…å®¹
methods(print)
methods(summary)

?par # parameterï¼ˆç”¨äºå¾®è°ƒï¼‰
par() # æ˜¾ç¤ºRç»˜å›¾çš„é»˜è®¤è®¾ç½®
plot(as.factor(mtcars$cyl), col=c("red", "green", "blue")) # colä¸ºå…¶ä¸­ä¸€é¡¹å‚æ•°

# 2. latticeåŒ…

# 3. ggplot2åŒ…

# 4. gridåŒ…


# P50     è‡ªå®šä¹‰å‡½æ•°------------------------------------------------------------

# è‡ªå·±ç¼–å†™å‡½æ•°
# è¾“å…¥ä¸åŠ æ‹¬å·çš„å‡½æ•°ï¼Œè¾“å‡ºæºä»£ç 

# 1. å‡½æ•°åç§°
# 1.1 å‡½æ•°å‘½ä»¤ä¸åŠŸèƒ½ç›¸å…³
# 1.2 å¯ä»¥æ˜¯å­—æ¯ä¸æ•°å­—çš„ç»“åˆï¼Œä½†å¿…é¡»æ˜¯å­—æ¯å¼€å¤´
# 2. å‡½æ•°å£°æ˜
# 3. å‡½æ•°å‚æ•°
# 4. å‡½æ•°ä½“

myfun <- function(é€‰é¡¹å‚æ•°)
{
  å‡½æ•°ä½“
        }

# ä¾‹å­ï¼šè®¡ç®—ååº¦å’Œå³°åº¦çš„å‡½æ•°
# ååº¦ï¼ˆskewnessï¼‰ï¼šç»Ÿè®¡æ•°æ®åˆ†å¸ƒåæ–œæ–¹å‘å’Œç¨‹åº¦çš„åº¦é‡ï¼Œæ˜¯ç»Ÿè®¡æ•°æ®åˆ†å¸ƒéå¯¹ç§°ç¨‹åº¦çš„æ•°å­—ç‰¹å¾ã€‚
# å³°åº¦ï¼ˆpeakednessï¼›kurtosisï¼‰ï¼šå³°æ€ç³»æ•°ã€‚è¡¨å¾æ¦‚ç‡å¯†åº¦åˆ†å¸ƒæ›²çº¿åœ¨å¹³å‡å€¼å¤„å³°å€¼é«˜ä½çš„ç‰¹å¾æ•°ã€‚
x <- 1:100
mystats <- function(x, na.omit=FALSE) {
  if(na.omit)
    x <- x[!is.na(x)] # xåªå–ä¸åŒ…å«NAçš„å€¼
  m <- mean(x)
  n <- length(x)
  s <- sd(x)
  skew <- sum((x-m)^3 / s^3) / n
  kurt <- sum((x-m)^4 / s^4) / n-3
  return(c(n=n, mean=m, stdev=s, skewness=skew, kurtosis=kurt))
}
mystats(x)

# å¾ªç¯ä¸å‘é‡åŒ–æ“ä½œï¼šå‡½æ•°å†…éƒ¨é€šè¿‡å¾ªç¯å®ç°å‘é‡åŒ–æ“ä½œ
# ifæ¡ä»¶åˆ¤æ–­
score=70;if (score > 60) {print("Passed")} else {print("Failed")}
ifelse(score > 60, "Passed", "Failed") # ä¸¤ç§å†™æ³•ï¼ˆifelseè‡ªå¸¦è¾“å‡ºåŠŸèƒ½ï¼‰
# forå¾ªç¯
for (i in 1:10) {print("Hello")}
# whileå¾ªç¯
i=1;while(i <= 10) {print("Hello");i=i+1;}
# switchè¯­å¥ç­‰

# å¾ªç¯ä¸‰éƒ¨åˆ†
# 1. æ¡ä»¶åˆ¤æ–­ï¼ŒçœŸæˆ–å‡
# 2. ç”¨äºå¾ªç¯æ‰§è¡Œçš„ç»“æ„
# 3. è¡¨è¾¾å¼

rawData$ratio1 <- (rawData$act + rawData$dlc) / (rawData$act + rawData$ppent)
# æ•°æ®é›†åˆ—çš„è®¡ç®—æ–¹æ³•

# P51     æ•°æ®åˆ†æå®æˆ˜----------------------------------------------------------

# å°éº¦äº§é‡æ¡ˆä¾‹
# æˆ¿åœ°äº§æ¡ˆä¾‹
# æ€§ä»·æ¯”æ¡ˆä¾‹
# è¯ç‰©è¯•éªŒæ¡ˆä¾‹
# ç¤¾ä¼šç§‘å­¦ç ”ç©¶æ¡ˆä¾‹
# é‡åŒ–æŠ•èµ„æ¡ˆä¾‹ï¼ˆè®¡é‡ç»æµå­¦ï¼‰

# åé¢æ¡ˆä¾‹
# è‹¹æœçš„Think differentï¼Ÿï¼Ÿï¼Ÿ


# P52-53  çº¿æ€§å›å½’ï¼ˆregressionï¼‰------------------------------------------------

# å›å½’ï¼šæŒ‡é‚£äº›ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªé¢„æµ‹å˜é‡ï¼ˆè‡ªå˜é‡ã€è§£é‡Šå˜é‡ï¼‰ï¼Œæ¥é¢„æµ‹å“åº”å˜é‡ï¼ˆå› å˜é‡ã€æ•ˆæ ‡å˜é‡ã€ç»“æœå˜é‡ï¼‰çš„æ–¹æ³•ã€‚
# æ ¹æ®ä¸€å¤§å †æ•°æ®ï¼Œæ‰¾åˆ°å®ƒä»¬çš„è§„å¾‹ã€‚

# å¦‚ä½•å»ºç«‹æ¨¡å‹ã€‚æŠ½è±¡å‡ºæ•°å­¦å…¬å¼ï¼Œå“ªäº›å› ç´ ä¸æ¨¡å‹æœ‰å…³ï¼Œéœ€è¦åˆ©ç”¨å¤šå°‘æ ·å“ï¼Œæ¨¡å‹çš„å‡†ç¡®ç‡æœ‰å¤šé«˜ï¼Œåœ¨å®é™…è¿ç”¨ä¸­è¿˜æ˜¯å¦æœ‰æ•ˆã€‚

# çº¿æ€§å›å½’ æˆ– éçº¿æ€§å›å½’

# æ™®é€šæœ€å°äºŒä¹˜å›å½’æ³•ï¼ˆOLSï¼‰
women
plot(women$height, women$weight)
?lm
fit <- lm(formula = weight ~ height, data = women) # çº¿æ€§å›å½’åˆ†æï¼ˆæ‹Ÿåˆï¼‰
fit
summary(fit) 
# æ®‹å·®ï¼ˆresidualsï¼‰è¶Šå°ï¼Œè¶Šæ¥è¿‘çº¿æ€§å…³ç³»
# R-squared è¡¨ç¤ºç¬¦åˆæ¨¡å‹çš„æ•°æ®å æ¯”
# ä¸€èˆ¬å…ˆçœ‹p-valueæ˜¯å¦<0.05ï¼Œå¦‚æœä¸å°äºä¸€èˆ¬è¯´æ˜æ¨¡å‹ä¸ç¬¦åˆ
# å†çœ‹R-squaredï¼Œæœ‰å¤šå°‘æ•°æ®ç¬¦åˆæ¨¡å‹

"~" #åˆ†å‰²ç¬¦å·
# å·¦è¾¹ä¸ºå“åº”å˜é‡ï¼ˆyï¼‰ï¼Œå³è¾¹æ˜¯è§£é‡Šå˜é‡ï¼ˆxï¼‰ã€‚
# ä¾‹å¦‚ï¼Œè¦é€šè¿‡xã€zå’Œwé¢„æµ‹yï¼Œä»£ç ä¸ºy~x+z+w

"+" # åˆ†éš”é¢„æµ‹

":" # è¡¨ç¤ºé¢„æµ‹å˜é‡çš„äº¤äº’é¡¹
# æ¯”å¦‚ï¼Œè¦é€šè¿‡xã€zåŠxä¸zçš„äº¤äº’é¡¹æ¥é¢„æµ‹yï¼Œä»£ç ä¸ºy ~ x + z + x:z

"*" # è¡¨ç¤ºæ‰€æœ‰å¯èƒ½äº¤äº’é¡¹çš„ç®€æ´æ–¹å¼
# ä»£ç  y ~ x * z * w å¯å±•å¼€ä¸º y ~ x + z + w + x:z + x:w + z:w + x:z:w

"^" # è¡¨ç¤ºäº¤äº’é¡¹è¾¾åˆ°æŸä¸ªæ¬¡æ•°
# ä»£ç  y ~ (x + z + w)^2 å¯å±•å¼€ä¸º y ~ x + z + w + x:z + x:w + z:w

"." # è¡¨ç¤ºåŒ…å«é™¤å› å˜é‡å¤–çš„æ‰€æœ‰å˜é‡
# æ¯”å¦‚ï¼Œè‹¥ä¸€ä¸ªæ•°æ®æ¡†åŒ…å«å˜é‡xã€yã€zå’Œwï¼Œä»£ç  y ~. å¯å±•å¼€ä¸º y ~ x + z + w

"-" # å‡å·ï¼Œè¡¨ç¤ºä»ç­‰å¼ä¸­ç§»é™¤æŸä¸ªå˜é‡
# ä»£ç  y ~ (x + z + w)^2 - x:w å¯å±•å¼€ä¸º y ~ x + z + w + x:z + z:w

"-1" # åˆ é™¤æˆªè·é¡¹
# æ¯”å¦‚ï¼Œè¡¨è¾¾å¼ y ~ x - 1 æ‹Ÿåˆyåœ¨xä¸Šçš„å›å½’ï¼Œå¹¶å¼ºåˆ¶ç›´çº¿é€šè¿‡åŸç‚¹

I() # ä»ç®—æœ¯çš„è§’åº¦æ¥è§£é‡Šæ‹¬å·ä¸­çš„å…ƒç´ 
# æ¯”å¦‚ï¼Œy~x+(z+w)^2 å±•å¼€ä¸º y~x+z+w+z:w
# ä»£ç  y~x+ I((z+w)^2) å±•å¼€ä¸º y~x+h ï¼ˆhæ˜¯ä¸€ä¸ªç”±zå’Œwçš„å¹³æ–¹å’Œåˆ›å»ºçš„æ–°å˜é‡ï¼‰

"function()" # å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ç”¨çš„æ•°å­¦å‡½æ•°
# æ¯”å¦‚ï¼Œlog(y) ~ x + z + w è¡¨ç¤ºé€šè¿‡xã€zå’Œwæ¥é¢„æµ‹log(y)

# çº¿æ€§æ‹Ÿåˆå¸¸ç”¨å‡½æ•°
summary() # å±•ç¤ºæ‹Ÿåˆæ¨¡å‹çš„è¯¦ç»†ç»“æœ
coefficients() # åˆ—å‡ºæ‹Ÿåˆæ¨¡å‹çš„æ¨¡å‹å‚æ•°ï¼ˆy-interceptå’Œslopeï¼‰
confint(data, level = 0.5) # æä¾›æ¨¡å‹å‚æ•°çš„confidence intervalï¼ˆé»˜è®¤95%ï¼Œç”¨levelå‚æ•°è°ƒæ•´ï¼‰
fitted() # åˆ—å‡ºæ‹Ÿåˆæ¨¡å‹çš„é¢„æµ‹å€¼
residuals() # åˆ—å‡ºæ‹Ÿåˆæ¨¡å‹çš„æ®‹å·®å€¼ï¼ˆæ®‹å·®ï¼ˆresidualsï¼‰è¶Šå°ï¼Œè¶Šæ¥è¿‘çº¿æ€§å…³ç³»ï¼‰
anova() # ç”Ÿæˆä¸€ä¸ªæ‹Ÿåˆæ¨¡å‹çš„æ–¹å·®åˆ†æè¡¨ï¼Œæˆ–è€…æ¯”è¾ƒä¸¤ä¸ªæˆ–å¤šä¸ªæ‹Ÿåˆæ¨¡å‹çš„æ–¹å·®åˆ†æè¡¨
vcov() # åˆ—å‡ºæ¨¡å‹å‚æ•°çš„åæ–¹å·®çŸ©é˜µ
AIC() # è¾“å‡ºèµ¤æ± ä¿¡æ¯ç»Ÿè®¡é‡
plot() # ç”Ÿæˆè¯„ä»·æ‹Ÿåˆæ¨¡å‹çš„è¯Šæ–­å›¾
predict(model, new.data) # ç”¨æ‹Ÿåˆæ¨¡å‹å¯¹æ–°çš„æ•°æ®é›†é¢„æµ‹å“åº”å˜é‡å€¼
abline() # ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿ï¼Œç›´çº¿

# e.g.
coefficients(fit)
confint(fit)
confint(fit, level = 0.5)
fitted(fit) 
women$weight-fitted(fit)
residuals(fit)
women1 <- women # æ–°ç”Ÿæˆæ•°æ®
predict(fit,women1) # å¯¹æ–°ç”Ÿæˆçš„æ•°æ®é¢„æµ‹
plot(fit)
plot(women$height,women$weight)
abline(fit) # ç»˜åˆ¶æ‹Ÿåˆç›´çº¿

# å¤šé¡¹å¼
fit2 <- lm(weight ~ height + I(height^2), data = women) # å›å½’å¼ä¸­å¹³æ–¹çš„å†™æ³•
fit2
summary(fit2)
lines(women$height, fitted(fit2), col="red") # ç»“æœæ˜¾ç¤ºå¸¦æœ‰äºŒæ¬¡é¡¹çš„å‡½æ•°å¯ä»¥æ›´å¥½æ‹Ÿåˆ
lines(x, y) # æ¨ªåæ ‡ï¼ˆxï¼‰ï¼Œçºµåæ ‡ï¼ˆyï¼‰ï¼ˆè¿™é‡Œçºµåæ ‡ç”¨äº†é¢„æµ‹å€¼ï¼‰
#ä¸‰æ¬¡é¡¹
fit3 <- lm(weight ~ height + I(height^2) + I(height^3), data = women)
summary(fit3)
lines(women$height, fitted(fit3), col="blue")

# ä¸èƒ½æ‹Ÿåˆä¸è¶³ï¼Œä¹Ÿä¸èƒ½æ‹Ÿåˆè¿‡åº¦



# P54     å¤šå…ƒçº¿æ€§å›å½’----------------------------------------------------------

# å¤šä¸ªå˜é‡ï¼Œæƒé‡ä¹Ÿä¸åŒ
state.x77
states <- as.data.frame(state.x77, c("Murder", "Population", "Illiteracy", "Income", "Frost"))
# è½¬åŒ–ä¸ºæ•°æ®æ¡†
fit <- lm(Murder ~ Population + Illiteracy + Income + Frost, data = states)
summary(fit)
coef(fit)
options(digits = 4) # æ˜¾ç¤ºå°æ•°ç‚¹å4ä½
# qqplot(fit, labels = row.names(states), id.method = "identify", simulate = T, main = "Q-Q Plot")

fit2 <- lm(mpg ~ hp + wt + hp:wt, data = mtcars)
summary(fit2)

# å¦‚ä½•ä»ä¼—å¤šæ¨¡å‹ä¸­ï¼Œé€‰æ‹©æœ€ä½³æ¨¡å‹
?AIC
# æ¯”è¾ƒæ¨¡å‹,AICå€¼è¶Šå°è¶Šå¥½
m1 <- lm(Murder ~ Population + Illiteracy + Income + Frost, data = states)
m2 <- lm(Murder ~ Population + Illiteracy, data = states)
AIC(m1, m2)

# é€æ­¥å›å½’æ³•ï¼ˆBackward stepwise selectionï¼‰
library(MASS)
states <- as.data.frame(state.x77, c("Murder", "Population", "Illiteracy", "Income", "Frost"))
fit <- lm(Murder ~ Population + Illiteracy + Income + Frost, data = states)
stepAIC(fit, direction = "backward")

# å…¨å­é›†å›å½’æ³•ï¼ˆAll subsets regressionï¼‰
library(leaps)
states <- as.data.frame(state.x77, c("Murder", "Population", "Illiteracy", "Income", "Frost"))
leaps <- regsubsets(Murder ~ Population + Illiteracy + Income + Frost, data = states, nbest = 4)
plot(leaps, scale = "adjr2")


# P55     å›å½’è¯Šæ–­--------------------------------------------------------------

fit <-  lm(weight ~ height, data=women)
opar <- par(no.readonly = T)
par(mfrow=c(2,2)) # è¡¨ç¤ºæ¨ªæ’ç«–æ’å„æ˜¾ç¤ºä¸¤å¹…
plot(fit) # plotç»˜åˆ¶å‡ºçš„å››å¹…å›¾æ˜¯ä¸ºäº†è¯„ä»·æ˜¯å¦æ»¡è¶³OLSæ¨¡å‹ç»Ÿè®¡å‡è®¾å››æ¡ä»¶
# å›¾ä¸€ æ®‹å·®ä¸æ‹Ÿåˆï¼Œå› å˜é‡ä¸è‡ªå˜é‡æ˜¯å¦å‘ˆçº¿æ€§å…³ç³»ï¼Œå›¾ä¸­ç‚¹ä¸ºæ®‹å·®å€¼åˆ†å¸ƒï¼Œæ›²çº¿ä¸ºæ‹Ÿåˆæ›²çº¿ã€‚
#      è‹¥å­˜åœ¨æ›²çº¿ï¼Œè¯´æ˜å› å˜é‡ä¸è‡ªå˜é‡å­˜åœ¨äºŒæ¬¡æ–¹å…³ç³»ã€‚
# å›¾äºŒ Q-Qå›¾ï¼Œæè¿°æ­£æ€æ€§ï¼Œè‹¥æ•°æ®å‘ˆæ­£æ€åˆ†å¸ƒï¼Œåˆ™ç‚¹å‘ˆä¸€æ¡ç›´çº¿ï¼Œæ®‹å·®å€¼ä¹Ÿæˆç›´çº¿åˆ†å¸ƒ
# å›¾ä¸‰ Scale-Location ä½ç½®ä¸å°ºå¯¸å›¾ï¼Œç”¨æ¥æè¿°åŒæ–¹å·®æ€§ï¼Œè‹¥æ»¡è¶³ä¸å˜æ–¹å·®å‡è®¾ï¼Œæ›²çº¿å‘¨å›´ç‚¹å‘ˆéšæœºåˆ†å¸ƒ
# å›¾å›› Residuals vs Leverage æ®‹å·®ä¸æ æ†å›¾ï¼Œæä¾›å¯¹å•ä¸ªæ•°æ®é›†çš„è§‚æµ‹ï¼Œä»å›¾ä¸­å¯é‰´åˆ«åå·®è¾ƒè¿œç‚¹ï¼Œ
#      ä»è€Œåˆ†è¾¨ç¦»ç¾¤ç‚¹ã€é«˜æ æ†ç‚¹ã€å¼ºå½±å“ç‚¹ã€‚ç¦»ç¾¤ç‚¹è¡¨ç¤ºè¯¥ç‚¹æ®‹å·®å€¼è¾ƒå¤§ï¼Œä¸é€‚åˆæ¨¡å‹ï¼›
#      é«˜æ æ†ç‚¹è¡¨ç¤ºè¯¥ç‚¹ä¸ºå¼‚å¸¸é¢„æµ‹å˜é‡ç»„åˆï¼›å¼ºå½±å“ç‚¹è¡¨ç¤ºè¯¥ç‚¹å¯¹æ¨¡å‹å‚æ•°çš„å½±å“è¿‡å¤§
#      è¿™äº›ç‚¹å¯ç”¨åº“å…‹è·ç¦»Cook's distanceæ¥é‰´åˆ«ï¼Œå°†è¿™äº›ç‚¹åˆ é™¤ä¼šä½¿æ¨¡å‹æ‹Ÿåˆæ›´å¥½ï¼›
#      æˆ–è€…å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œå¦‚ï¼šå¯¹æ‰€æœ‰æ•°æ®å–æŒ‡æ•°ã€å–å¯¹æ•°ç­‰
par(opar)

# æ»¡è¶³OLSæ¨¡å‹ç»Ÿè®¡å‡è®¾
# 1. æ­£æ€æ€§ï¼šå¯¹äºå›ºå®šçš„è‡ªå˜é‡å€¼ï¼Œå› å˜é‡å€¼æˆæ­£æ€åˆ†å¸ƒ
# 2. ç‹¬ç«‹æ€§ï¼šå› å˜é‡ä¹‹é—´äº’ç›¸ç‹¬ç«‹
# 3. çº¿æ€§ï¼šå› å˜é‡ä¸è‡ªå˜é‡ä¹‹é—´ä¸ºçº¿æ€§å…³ç³»
# 4. åŒæ–¹å·®æ€§ï¼šå› å˜é‡çš„æ–¹å·®ä¸éšè‡ªå˜é‡çš„æ°´å¹³ä¸åŒè€Œå˜åŒ–ã€‚ä¹Ÿå¯ç§°ä½œä¸å˜æ–¹å·®ã€‚

fit2 <- lm(weight ~ height + I(height^2), data = women)
opar <- par(no.readonly = T)
par(mfrow=c(2,2))
plot(fit2)
par(opar)

# æŠ½æ ·æ³•éªŒè¯
# 1. æ•°æ®ä¸­æœ‰1000ä¸ªæ ·æœ¬ï¼ŒéšæœºæŠ½å–500ä¸ªæ•°æ®è¿›è¡Œå›å½’åˆ†æ
# 2. æ¨¡å‹å»ºå¥½åï¼Œåˆ©ç”¨predict()ï¼Œå¯¹å‰©ä¸‹çš„500ä¸ªæ ·æœ¬è¿›è¡Œé¢„æµ‹ï¼Œæ¯”è¾ƒæ®‹å·®å€¼
# 3. å¦‚æœé¢„æµ‹å‡†ç¡®ï¼Œè¯´æ˜æ¨¡å‹å¯ä»¥ï¼Œå¦åˆ™å°±éœ€è¦è°ƒæ•´æ¨¡å‹



# P56-57  æ–¹å·®åˆ†æï¼ˆAnalysis of Varianceï¼‰--------------------------------------------------------------

# æ–¹å·®åˆ†æï¼ˆAnalysis of Variance / ANOVAï¼‰ï¼Œä¹Ÿç§°å˜å¼‚æ•°åˆ†æ
# ç”¨äºä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šæ ·æœ¬å‡æ•°å·®åˆ«çš„æ˜¾è‘—æ€§æ£€éªŒã€‚
# ä»å¹¿ä¹‰ä¸Šæ¥è®²ï¼Œæ–¹å·®åˆ†æå±äºå›å½’åˆ†æçš„ä¸€ç§ã€‚ä½†çº¿æ€§å›å½’çš„å› å˜é‡ä¸€èˆ¬æ˜¯è¿ç»­å‹å˜é‡ã€‚è€Œå½“è‡ªå˜é‡æ˜¯å› å­æ—¶ï¼Œç ”ç©¶å…³æ³¨çš„é‡ç‚¹é€šå¸¸ä¼šä»é¢„æµ‹è½¬å‘ä¸åŒç»„ä¹‹é—´å·®å¼‚çš„æ¯”è¾ƒã€‚

# 1. å•å› ç´ æ–¹å·®åˆ†æANOVAï¼ˆç»„å†…ï¼Œç»„é—´ï¼‰
y ~ A # å•å› ç´ ANOVA
y ~ A + Error(Subject/A) # å•å› ç´ ç»„å†…ANOVA
y ~ B * W + Error(Subject/w) # å«å•ä¸ªç»„å†…å› å­ï¼ˆwï¼‰å’Œå•ä¸ªç»„é—´å› å­ï¼ˆbï¼‰çš„é‡åº¦æµ‹é‡ANOVA
# æ¡ˆä¾‹
library(multcomp)
?cholesterol
attach(cholesterol) # åŠ è½½æ•°æ®é›†
table(trt) # è¿›è¡Œåˆ†ç»„ç»Ÿè®¡ï¼Œå¹¶å±•ç¤º
aggregate(response, by=list(trt), FUN=mean)
fit <- aov(response ~ trt, data = cholesterol) # åšæ–¹å·®åˆ†æ
summary(fit) # æ˜¾ç¤ºç»Ÿè®¡ç»“æœ
plot(fit) # å¯¹ç»“æœè¿›è¡Œç»˜å›¾
fit.lm <- lm(response ~ trt, data = cholesterol) # å®šä¹‰æ–°çš„å˜é‡
summary(fit.lm) # å±•ç¤ºå›å½’ç»“æœ
# æ¯”è¾ƒäºŒè€…å·®åˆ«ï¼Œçº¿æ€§æ‹Ÿåˆè¦æ±‚é¢„æµ‹å˜é‡ä¸ºæ•°å€¼å‹ï¼Œlmå‡½æ•°åœ¨é‡åˆ°å˜é‡ä¸ºå› å­æ—¶ï¼Œ
# å°±ä¼šç”¨ä¸€ç³»åˆ—ä¸å› å­å¯¹ç…§çš„æ•°å€¼å‹å˜é‡æ›¿æ¢å› å­ï¼Œå› æ­¤lmä¹Ÿå¯ä»¥åšæ–¹å·®åˆ†æ

# å•å› ç´ åæ–¹å·®ä¾‹å­
litter # ç¤ºä¾‹æ•°æ®é›†
?litter
table(litter$dose) # ç»Ÿè®¡åˆ†ç»„æƒ…å†µ
attach(litter) # åŠ è½½æ•°æ®é›†
aggregate(weight,by=list(dose),FUN=mean) # åˆ©ç”¨aggregateå‡½æ•°ç»Ÿè®¡è¯„å·å€¼
fit <- aov(weight ~ gesttime+dose,data = litter) # è¿›è¡Œæ–¹å·®åˆ†æ
summary(fit) # æ˜¾ç¤ºç»Ÿè®¡ç»“æœ

# 2. åŒå› ç´ æ–¹å·®åˆ†æANOVA
y ~ A * B
# æ¡ˆä¾‹
ToothGrowth
?ToothGrowth
attach(ToothGrowth) # åŠ è½½æ•°æ®é›†
xtabs(~ supp+dose) #ç»Ÿè®¡é¢‘ç‡
aggregate(len, by=list(supp, dose), FUN=mean) # ç»Ÿè®¡å¹³å‡å€¼
aggregate(len, by=list(supp, dose), FUN=sd)
ToothGrowth$dose <- factor(ToothGrowth$dose) # å°†æ•°æ®è½¬åŒ–ä¸ºå› å­
fit <- aov(len ~ supp*dose, data=ToothGrowth) # è¿›è¡Œsuppå’Œdoseä¸¤ä¸ªå˜é‡çš„æ–¹å·®åˆ†æ
summary(fit)
install.packages("HH")  
library(HH)
interaction.plot(dose, supp, len, type = "b", col = c("red", "blue"), 
                 pch = c(16,18), 
                 main = "Interaction between Dose and Supplement Type")
# å¯¹ç»“æœè¿›è¡Œå¯è§†åŒ–ï¼Œè€Œä¸”å¯¹ä»»ä½•å› å­æ¶‰åŠçš„ä¸»æ•ˆåº”å’Œäº¤äº’æ•ˆåº”éƒ½è¿›è¡Œå±•ç¤º

# 3. åæ–¹å·®åˆ†æANCOVA
y ~ x + A # å«å•ä¸ªåå˜é‡çš„å•å› ç´ ANCOVA
y ~ x1 + x2 + A*B # å«ä¸¤ä¸ªåå˜é‡çš„åŒå› ç´ ANCOVA
# å•å› ç´ åæ–¹å·®æ¡ˆä¾‹
table(litter$dose)
attach(litter) # åŠ è½½æ•°æ®é›†
aggregate(weight, by=list(dose), FUN=mean)
fit <- aov(weight ~ gesttime+dose, data=litter) # gesttimeä¸ºåå˜é‡
summary(fit)

# 4. å¤šå…ƒæ–¹å·®åˆ†æMANOVA
# æ¡ˆä¾‹
library(MASS)
?UScereal
UScereal
attach(UScereal) # åŠ è½½æ•°æ®é›†
shelf <- factor(shelf) # å°†æ•°æ®è½¬åŒ–ä¸ºå› å­
aggregate(cbind(calories, fat, sugars), by=list(shelf), FUN=mean) # è®¡ç®—å¹³å‡å€¼ï¼Œé€šè¿‡listè¿›è¡Œåˆ†ç»„
fit <- manova(cbind(calories, fat, sugars) ~ shelf, data=UScereal) # æ£€æµ‹ä¸åŒç»„ä¹‹é—´å·®åˆ«æ˜¯å¦æ˜¾è‘—
# ç”±äºè‡ªå˜é‡ä¸ºcalories, fat, sugarsæœ‰ä¸‰ä¸ªï¼Œè€Œå› å˜é‡ä¸ºshelfåªæœ‰ä¸€ä¸ªï¼Œå·¦å¤šå³å°‘ï¼Œå› æ­¤è‡ªå˜é‡ä¹‹é—´ä¸èƒ½ç”¨+ï¼Œé€‰æ‹©ç”¨cbind( , , )
summary(fit) # æŸ¥çœ‹ç»“æœ
summary.aov(fit) # æŸ¥çœ‹æ›´ä¸ºè¯¦ç»†ç»“æœ

# 5. å¤šå…ƒåæ–¹å·®åˆ†æMANCOVA

?aov

y ~ B + A (Bæ˜¯åŒºç»„å› å­) # éšæœºåŒ–åŒºç»„

# é¡ºåºå¾ˆé‡è¦
y ~ A + B + A:B
# åœ¨Rä¸­ï¼Œé¡ºåºä¸ºåºè´¯å‹ã€‚æ•ˆåº”æ ¹æ®è¡¨è¾¾å¼ä¸­å…ˆå‡ºç°çš„æ•ˆåº”åšè°ƒæ•´ã€‚
# Aä¸åšè°ƒæ•´ï¼ŒBæ ¹æ®Aåšè°ƒæ•´ï¼ŒA:Bäº¤äº’é¡¹æ ¹æ®Aå’ŒBè°ƒæ•´ã€‚



# P58     åŠŸæ•ˆåˆ†æï¼ˆPower Analysisï¼‰--------------------------------------------

# åŠŸæ•ˆåˆ†æï¼Œå¯ä»¥å¸®åŠ©åœ¨ç»™å®šç½®ä¿¡åº¦çš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­æ£€æµ‹åˆ°ç»™å®šæ•ˆåº”å€¼æ—¶æ‰€éœ€çš„æ ·æœ¬é‡ã€‚
# åè¿‡æ¥ï¼Œå®ƒä¹Ÿå¯ä»¥åœ¨ç»™å®šç½®ä¿¡åº¦æ°´å¹³æƒ…å†µä¸‹ï¼Œè®¡ç®—åœ¨æŸæ ·æœ¬é‡å†…èƒ½æ£€æµ‹åˆ°ç»™å®šæ•ˆåº”å€¼çš„æ¦‚ç‡ã€‚

# åŠŸæ•ˆåˆ†æå‡½æ•°ï¼ˆpwråŒ…ä¸­çš„å‡½æ•°ï¼‰
install.packages("pwr")
library(pwr)
pwr.2p.test() # ä¸¤æ¯”ä¾‹ï¼ˆnç›¸ç­‰ï¼‰
pwr.2p2n.test() # ä¸¤æ¯”ä¾‹ï¼ˆnä¸ç›¸ç­‰ï¼‰
pwr.anova.test() # å¹³è¡¡çš„å•å› ç´ ANOVA
pwr.anova.test(k=2, f=0.25, sig.level=0.05, power=0.90)
pwr.chisq.test() # å¡æ–¹æ£€éªŒ
pwr.f2.test() # å¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼ˆLinear Modelsï¼‰
pwr.f2.test(u=3, f2=0.0769, sig.level=0.05, power=0.90)
#  v = 184.2
# å‡å®šæ˜¾è‘—æ€§æ°´å¹³ä¸º0.05ï¼Œåœ¨90%çš„ç½®ä¿¡åº¦ä¸‹ï¼Œè‡³å°‘éœ€è¦185ä¸ªå—æ²»è€…æ‰å¯ä»¥

# æ–¹å·®åˆ†æåŠŸæ•ˆåˆ†ææ¡ˆä¾‹
options(digits = 5)
pwr.f2.test(u=3, f2=0.0769, sig.level=0.05, power=0.90)

pwr.p.test() # æ¯”ä¾‹ï¼ˆå•æ ·æœ¬ï¼‰
pwr.r.test() # ç›¸å…³ç³»æ•°
pwr.t.test() # tæ£€éªŒï¼ˆå•æ ·æœ¬ã€ä¸¤æ ·æœ¬ã€é…å¯¹ï¼‰
pwr.t.test(d=.8, sig.level=.05, power=.9, type="two.sample", alternative="two.sided")
pwr.t.test(n=20, d=.5, sig.level=.01, type="two.sample", alternative="two.sided")
pwr.t2n.test() # tæ£€éªŒï¼ˆnä¸ç›¸ç­‰çš„ä¸¤æ ·æœ¬ï¼‰

# åŠŸæ•ˆåˆ†æç†è®ºåŸºç¡€
# 1. æ ·æœ¬å¤§å°ï¼šå®éªŒè®¾è®¡ä¸­æ¯ç§æ¡ä»¶/ç»„ä¸­è§‚æµ‹çš„æ•°ç›®ã€‚
# 2. æ˜¾è‘—æ€§æ°´å¹³ï¼ˆalphaï¼‰ï¼šç”±Iå‹é”™è¯¯çš„æ¦‚ç‡æ¥å®šä¹‰ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯å‘ç°æ•ˆåº”ä¸å‘ç”Ÿçš„æ¦‚ç‡ã€‚
# 3. åŠŸæ•ˆï¼šé€šè¿‡Iå‡å»IIå‹é”™è¯¯çš„æ¦‚ç‡æ¥å®šä¹‰ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯çœŸå®æ•ˆåº”å‘ç”Ÿçš„æ¦‚ç‡ã€‚
# 4. æ•ˆåº”å€¼ï¼šæŒ‡çš„æ˜¯åœ¨å¤‡æ‹©æˆ–ç ”ç©¶å‡è®¾ä¸‹æ•ˆåº”çš„é‡ã€‚æ•ˆåº”å€¼çš„è¡¨è¾¾å¼ä¾èµ–äºå‡è®¾æ£€éªŒä¸­ä½¿ç”¨çš„ç»Ÿè®¡æ–¹æ³•ã€‚
# æœ‰å…¶ä¸­ä¸‰ä¸ªï¼Œå°±å¯ä»¥æ±‚å‡ºç¬¬å››ä¸ªæ•°


# P59     å¹¿ä¹‰çº¿æ€§æ¨¡å‹----------------------------------------------------------

# å¹¿ä¹‰çº¿æ€§æ¨¡å‹æ‰©å±•äº†çº¿æ€§æ¨¡å‹çš„æ¡†æ¶ï¼Œå®ƒåŒ…å«äº†éæ­£æ€å› å˜é‡çš„åˆ†æã€‚

?glm # Generalized Linear Models
install.packages("robust")
library(robust)
??breslow.dat
breslow.dat
data(breslow.dat, package="robust") # åŠ è½½æ•°æ®é›†
names(breslow.dat) # æŸ¥çœ‹è¡Œå
summary(breslow.dat[c(6,7,8,10)]) # ç»Ÿè®¡æ•°æ®é›†

# æ³Šæ¾å›å½’ï¼ˆPoisson regressionï¼‰
# ç”¨æ¥ä¸ºè®¡æ•°èµ„æ–™å’Œåˆ—è”è¡¨å»ºæ¨¡çš„ä¸€ç§å›å½’åˆ†æã€‚
# å‡è®¾å› å˜é‡æ˜¯æ³Šæ¾åˆ†å¸ƒï¼Œå¹¶å‡è®¾å®ƒå¹³å‡å€¼çš„å¯¹æ•°å¯è¢«æœªçŸ¥å‚æ•°çš„çº¿æ€§ç»„åˆå»ºæ¨¡ã€‚

attach(breslow.dat)
# fit regression
fit <- glm(sumY ~ Base + Age + Trt, data = breslow.dat, family = poisson(link="log"))
# æ³¨æ„æ³Šæ¾å›å½’å†™æ³•
summary(fit)

# intercept model parameter
coef(fit) # è·å–æ¨¡å‹ç³»æ•°
# æ³Šæ¾å›å½’ä¸­ï¼Œå› å˜é‡ä»¥æ¡ä»¶å˜é‡çš„å¯¹æ•°å½¢å¼æ¥å»ºæ¨¡ï¼Œ
# ä¿æŒå…¶ä»–è‡ªå˜é‡ä¸å˜ï¼Œè‡ªå˜é‡ageå¢åŠ 1ï¼Œå› å˜é‡çš„å¯¹æ•°å‡å€¼å°†å¢åŠ 0.02274ã€‚
exp(coef(fit)) # ç”±äºå¯¹æ•°å‡å€¼ä¸æ–¹ä¾¿åˆ†æï¼Œå¯ä»¥å–æŒ‡æ•°
# ä¿æŒå…¶ä»–è‡ªå˜é‡ä¸å˜ï¼Œè‡ªå˜é‡ageå¢åŠ 1ï¼Œå› å˜é‡å°†å¢åŠ 1.023ã€‚



# P60     Logisticå›å½’----------------------------------------------------------

# é€šè¿‡ä¸€ç³»åˆ—è¿ç»­å‹æˆ–ç±»åˆ«å‹é¢„æµ‹å˜é‡ï¼Œæ¥é¢„æµ‹äºŒå€¼å‹ç»“æœå˜é‡æ—¶ï¼ŒLogisticså›å½’å¾ˆæœ‰ç”¨ã€‚
install.packages("AER")
library(AER)
?Affairs
Affairs
data(Affairs, package="AER")
summary(Affairs) # å¯¹æ•°æ®è¿›è¡Œç»Ÿè®¡
table(Affairs$affairs) # å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„
prop.table(table(Affairs$affairs)) # æŒ‰ç…§æ¬¡æ•°è¿›è¡Œé¢‘ç‡åˆ†ç»„
prop.table(table(Affairs$gender)) # æŒ‰ç…§æ€§åˆ«è¿›è¡Œé¢‘ç‡åˆ†ç»„

# Logisticå›å½’éœ€è¦å˜é‡ä¸ºäºŒå€¼å‹ï¼Œå¯ä»¥åˆ›é€ 
# create binary outcome variable
Affairs$ynaffairs[Affairs$affairs > 0] <- 1 # ä»¤æ•°æ®é›†ä¸­å¯¹åº”åˆ—çš„>0çš„æ•°=1
Affairs$ynaffairs[Affairs$affairs == 0] <- 0 # ä»¤æ•°æ®é›†ä¸­å¯¹åº”åˆ—çš„=0çš„æ•°=0
head(Affairs)
Affairs$ynaffairs <- factor(Affairs$ynaffair, levels = c(0,1), labels = c("No", "Yes"))
# å°†Affairs$ynaffairå˜é‡è½¬åŒ–ä¸ºå› å­
head(Affairs)
table(Affairs$ynaffair) # æŸ¥çœ‹äºŒå€¼å‹å˜é‡åˆ†ç»„ç»“æœ

# fit full model
attach(Affairs) # åŠ è½½æ•°æ®ï¼Œå¯åœ¨è¾“å…¥å˜é‡æ—¶è‡ªåŠ¨è¡¥é½
fit <- glm(ynaffairs ~ gender + age + yearsmarried + children + 
             religiousness + education + occupation + rating, 
           data = Affairs, family = binomial())
summary(fit)

# fit reduced model # å‰”é™¤ä¸æ˜¾è‘—å˜é‡å†æ‹Ÿåˆ
fit2 <- glm(ynaffairs ~ age + yearsmarried + religiousness + rating, 
            data = Affairs, family = binomial())
summary(fit2)

# compare models
anova(fit, fit2, test = "Chisq") # å¡æ–¹æ£€éªŒå€¼è¿›è¡Œæ£€éªŒ
coef(fit2) # å¯ç”¨äºæ¯”è¾ƒä¸¤æ¬¡æ¨¡å‹æ¨¡æ‹Ÿçš„å·®åˆ«ï¼Œç”±äºPr(>Chi)=0.21ï¼Œä¸¤æ¬¡æ‹Ÿåˆç»“æœç›¸å·®ä¸å¤§ï¼Œè¯´æ˜å¯ä»¥å‰”é™¤ä¸æ˜¾è‘—å˜é‡
exp(coef(fit2))

# calculate probability of extramarital affair by marital ratings
# predict å¯ä»¥æ ¹æ®å·²æœ‰çš„æ•°æ®ç»“æœfit2å¯¹æ¨¡å‹æ–°æ•°æ®é›†è¿›è¡ŒéªŒè¯
# é¦–å…ˆåˆ›é€ ä¸€ä¸ªåŒ…å«é¢„æµ‹å˜é‡å€¼çš„è™šæ‹Ÿå˜é‡æ•°æ®é›†testdataï¼Œæ­¤å¤„ä¸ºæ–¹ä¾¿å–æ•°æ®å¹³å‡å€¼
testdata <- data.frame(rating = c(1,2,3,4,5), 
                       age = mean(Affairs$age), 
                       yearsmarried = mean(Affairs$yearsmarried), 
                       religiousness = mean(Affairs$religiousness))
testdata$prob <- predict(fit2, newdata = testdata, type = "response")
# ä½¿ç”¨æµ‹è¯•æ•°æ®é›†é¢„æµ‹ç›¸åº”æ¦‚ç‡
testdata # æŸ¥çœ‹æ•°æ®é›†

# calculate probability of extramarital affair by age
# æ§åˆ¶å…¶ä»–å˜é‡ï¼Œè§‚å¯Ÿå¹´é¾„å˜åŒ–å‡ºç°å©šå¤–æƒ…çš„æ¦‚ç‡
testdata <- data.frame(rating = mean(Affairs$rating), 
                       age = seq(17, 57, 10), 
                       yearsmarried = mean(Affairs$yearsmarried), 
                       religiousness = mean(Affairs$religiousness))
testdata$prob <- predict(fit2, newdata = testdata, type = "response")
testdata
# è¯¥æ–¹æ³•å¯ç ”ç©¶æ¯ä¸€é¢„æµ‹å˜é‡å¯¹ç»“æœçš„å½±å“


# P61     ä¸»æˆåˆ†åˆ†æ------------------------------------------------------------

# ä¸»æˆåˆ†åˆ†æï¼ˆPrincipal Component Analysis / PCAï¼‰
# ä¸€ç§æ•°æ®é™ç»´æŠ€å·§ã€‚
# å®ƒèƒ½å°†å¤§é‡ç›¸å…³å˜é‡è½¬åŒ–ä¸ºä¸€ç»„å¾ˆå°‘çš„ä¸ç›¸å…³å˜é‡ï¼Œè¿™äº›æ— å…³çš„å˜é‡ç§°ä¸ºä¸»æˆåˆ†ã€‚
# ä¸»æˆåˆ†å…¶å®æ˜¯å¯¹åŸå§‹å˜é‡é‡æ–°è¿›è¡Œçº¿æ€§ç»„åˆï¼Œå°†åŸæ¥ä¼—å¤šå…·æœ‰ä¸€å®šç›¸å…³æ€§çš„æŒ‡æ ‡ï¼Œé‡æ–°ç»„åˆä¸ºä¸€ç»„çš„æ–°çš„ç›¸äº’ç‹¬ç«‹çš„ç»¼åˆæŒ‡æ ‡ã€‚

# ä¸»æˆåˆ†åˆ†æå…¬å¼
# PC1 = A1X1 + A2X2 + ... + AkXk

# ä¸»æˆåˆ†åˆ†æä¸å› å­åˆ†ææ­¥éª¤
# 1. æ•°æ®é¢„å¤„ç†
# 2. é€‰æ‹©åˆ†ææ¨¡å‹
# 3. åˆ¤æ–­è¦é€‰æ‹©çš„ä¸»æˆåˆ†/å› å­æ•°ç›®ï¼ˆå¯é€šè¿‡ç¢çŸ³å›¾ï¼‰
# 4. é€‰æ‹©ä¸»æˆåˆ†/å› å­
# 5. æ—‹è½¬ä¸»æˆåˆ†/å› å­
# 6. è§£é‡Šç»“æœï¼ˆOptionalï¼‰
# 7. è®¡ç®—ä¸»æˆåˆ†/å› å­å¾—åˆ†ï¼ˆOptionalï¼‰

# Principal components analysis of the Judge Ratings
?princomp
library(psych)
help(package="psych")
USJudgeRatings
fa.parallel(USJudgeRatings, fa="pc", n.iter=100) # ç¢çŸ³å›¾ï¼ˆæ‰¾å‡ºn.factorsï¼‰
# å…¶ä¸­fa="pc"æŒ‡åšpcåˆ†æ
# å…¶ä¸­n.iter=100æŒ‡å¾ªç¯100æ¬¡
# å¯ç ”ç©¶å¹³è¡Œåˆ†ææ³•
pc <- principal(USJudgeRatings, nfactors=1,rotate = "none",scores=FALSE)
# é€šè¿‡principalå‡½æ•°å®šä¹‰ï¼ˆæ•°æ®é›†ï¼Œä¸»æˆåˆ†ä¸ªæ•°ï¼ŒæŒ‡å®šæ—‹è½¬æ–¹æ³•ï¼Œæ˜¯å¦è®¡ç®—ä¸»æˆåˆ†å¾—åˆ†
pc
# pc1è¡¨ç¤ºè§‚æµ‹å˜é‡ä¸ä¸»æˆåˆ†çš„ç›¸å…³ç³»æ•°
# h2è¡¨ç¤ºæˆåˆ†å…±å› å­çš„æ–¹å·®ï¼Œä¸»æˆåˆ†å¯¹æ¯ä¸ªå˜é‡çš„æ–¹å·®è§£é‡Šåº¦
# u2æŒ‡æ¯ä¸ªæ–¹å·®æ— æ³•è¢«ä¸»æˆåˆ†è§£é‡Šçš„æ¯”ä¾‹
# SS loadingsè¡¨ç¤ºä¸è¯¥ä¸»æˆåˆ†ç›¸å…³è”çš„ç‰¹å¾å€¼ï¼Œä¸ä¸»æˆåˆ†ç›¸å…³è”çš„å˜é‡æ ‡å‡†åŒ–åçš„æ–¹å·®å€¼
# Proportion Varè¡¨ç¤ºè¯¥ä¸»æˆåˆ†å¯¹æ•°æ®é›†çš„è§£é‡Šç¨‹åº¦

# PCA Score
pc <- principal(USJudgeRatings, nfactors=1, rotate = "none",scores=T) # scoreä¸ºæ˜¯å¦éœ€è¦è®¡ç®—ä¸»æˆåˆ†å¾—åˆ†ï¼Œé»˜è®¤F
pc$scores

# PCA Harman23.cor data
Harman23.cor
fa.parallel(Harman23.cor$cov, n.obs=302, fa="pc", n.iter=100, show.legend=F, main="Scree plot with parallel analysis")
# é¦–å…ˆåˆ¤æ–­ä¸»æˆåˆ†çš„æ•°ç›®ï¼Œå¡«å…¥ç›®æ ‡æ•°æ®é›†ç›¸å…³ç³»æ•°çŸ©é˜µï¼Œn.obsè®¾å®šæ ·æœ¬å¤§å°ï¼Œfaç»˜åˆ¶ç¢çŸ³å›¾ï¼Œn.iterå¾ªç¯æ¬¡æ•°ï¼Œ
# PCA of body measurement
pc <- principal(Harman23.cor$cov, nfactors=2, rotate="none")
pc

# ä½¿æˆåˆ†ä¸ç›¸å…³ï¼šæ­£äº¤æ—‹è½¬ï¼ˆå»å™ªï¼‰
# ä½¿æˆåˆ†ç›¸å…³ï¼šæ—‹äº¤æ—‹è½¬
?principal
pc <- principal(Harman23.cor$cov, nfactors=2, rotate="varimax")
pc
# æ—‹è½¬ä¹‹åæ”¹å˜çš„åªæ˜¯ä¸»æˆåˆ†å¯¹æ–¹å·®çš„è§£é‡Šåº¦ï¼Œå…¶è§£é‡Šåº¦è¶‹åŒï¼Œå¯ç§°ä¹‹ä¸ºæˆåˆ†ï¼Œè€Œéä¸»æˆåˆ†




# P62     å› å­åˆ†æ--------------------------------------------------------------

# æ¢ç´¢æ€§å› å­åˆ†ææ³•ï¼ˆExploratory Factor Analysis / EFAï¼‰
# ä¸€ç³»åˆ—ç”¨æ¥å‘ç°ä¸€ç»„å˜é‡çš„æ½œåœ¨ç»“æ„çš„æ–¹æ³•ã€‚
# å®ƒé€šè¿‡å¯»æ‰¾ä¸€ç»„æ›´å°çš„ã€æ½œåœ¨çš„æˆ–éšè—çš„ç»“æ„æ¥è§£é‡Šå·²è§‚æµ‹åˆ°çš„ã€æ˜¾å¼çš„å˜é‡é—´çš„å…³ç³»ã€‚
# å…¬å…±å› å­å¯è§£é‡Šå¤šä¸ªå˜é‡ä¹‹é—´çš„æ–¹å·®ï¼Œå› å­åˆ†æå°±æ˜¯ä¸ºæ‰¾åˆ°å…¬å…±å› å­

# å› å­åˆ†æå…¬å¼
# Xi = A1F1 + A2F2 + ... + ApFp + Ui
# Xiï¼šç¬¬iä¸ªå¯è§‚æµ‹çš„å˜é‡
# Fï¼šå…¬å…±å› å­
# Uiï¼šXiå˜é‡æ— æ³•è¢«å…¬å…±å› å­è§£é‡Šçš„éƒ¨åˆ†ï¼ˆè¯¯å·®ï¼‰

# ä¸»æˆåˆ†ä¸å› å­åˆ†ææ¯”è¾ƒ

# ç›¸åŒç‚¹
# 1. éƒ½å¯¹åŸå§‹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†
# 2. éƒ½æ¶ˆé™¤äº†åŸå§‹æŒ‡æ ‡çš„ç›¸å…³æ€§å¯¹ç»¼åˆè¯„ä»·æ‰€é€ æˆçš„ä¿¡æ¯é‡å¤çš„å½±å“
# 3. æ„é€ ç»¼åˆè¯„ä»·æ—¶æ‰€æ¶‰åŠçš„æƒæ•°å…·æœ‰å®¢è§‚æ€§
# 4. åœ¨ä¿¡æ¯æŸå¤±ä¸å¤§çš„å‰æä¸‹ï¼Œå‡å°‘äº†è¯„ä»·å·¥ä½œé‡
# 5. ç”¨ç¢çŸ³å›¾æ¥åˆ¤æ–­ä¸»æˆåˆ†/å› å­æ•°é‡

# ä¸åŒç‚¹

# ä¸»æˆåˆ†åˆ†æï¼š
# 1. ç”¨è¾ƒå°‘çš„å˜é‡è¡¨ç¤ºåŸæ¥çš„æ ·æœ¬
# 2. ç›®çš„æ˜¯æ ·æœ¬æ•°æ®ä¿¡æ¯æŸå¤±æœ€å°çš„åŸåˆ™ä¸‹ï¼Œå¯¹é«˜ç»´å˜é‡è¿›è¡Œé™ç»´
# 3. å‚æ•°ä¼°è®¡ï¼Œä¸€èˆ¬æ˜¯æ±‚ç›¸å…³çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç›¸åº”çš„ç‰¹å¾å‘é‡ï¼Œå–å‰å‡ ä¸ªè®¡ç®—ä¸»æˆåˆ†
# 4. åº”ç”¨ï¼šåº”ç”¨è¾ƒå°‘å˜é‡æ¥è§£é‡Šå„ä¸ªæ ·æœ¬çš„ç‰¹å¾

# å› å­åˆ†æï¼š
# 1. ç”¨è¾ƒå°‘çš„å› å­è¡¨ç¤ºåŸæ¥çš„å˜é‡
# 2. ç›®çš„æ˜¯å°½å¯èƒ½ä¿å­˜åŸå˜é‡çš„ç›¸äº’å…³ç³»ï¼Œå¯»æ‰¾å˜é‡çš„å…¬å…±å› å­
# 3. å‚æ•°ä¼°è®¡ï¼ŒæŒ‡å®šå‡ ä¸ªå› å­ï¼Œå°†å…¶è¿˜åŸæˆç›¸å…³ç³»æ•°çŸ©é˜µï¼Œåœ¨å’ŒåŸæ ·æœ¬ç›¸å…³çŸ©é˜µæœ€ç›¸ä¼¼åŸåˆ™ä¸‹ï¼Œä¼°è®¡å„ä¸ªå…¬å› å­çš„ä¼°è®¡å€¼
# 4. åº”ç”¨ï¼šæ‰¾åˆ°å…·æœ‰æœ¬è´¨æ„ä¹‰çš„å°‘é‡å› å­æ¥å½’çº³åŸæ¥å˜é‡çš„ç‰¹å¾

?factanal()
library(psych)
ability.cov  # æŸ¥çœ‹æ•°æ®é›†
options(digits = 2) # ä¿ç•™ä¸¤ä½å°æ•°
covariances <- ability.cov$cov # ç”±äºability.covä¸ºåˆ—è¡¨ï¼Œå› æ­¤å–å‡ºå…¶ä¸­covçŸ©é˜µå®šä¹‰ä¸ºcovariances
correlations <- cov2cor(covariances) # å°†åæ–¹å·®çŸ©é˜µè½¬æ¢æˆç³»æ•°çŸ©é˜µ
fa.parallel(correlations, fa="both", n.obs=112, n.iter=100) # åˆ¤æ–­æå–çš„å› å­æ•°
?fa
fa <- fa(correlations, nfactors=2, rotate="none", fm="pa")
# fmå®šä¹‰æå–å…¬å› å­çš„æ–¹æ³•ï¼Œpaä¸ºä¸»è½´è¿­ä»£æ³•
fa
# æ­£äº¤æ—‹è½¬ï¼ˆPC1å’ŒPC2æ²¡æœ‰å…³ç³»ï¼‰
fa.varimax <- fa(correlations, nfactors=2, rotate="varimax", fm="pa")
fa.varimax
# æ–œäº¤æ—‹è½¬ï¼ˆPC1å’ŒPC2æœ‰å…³ç³»ï¼‰
fa.promax <- fa(correlations, nfactors=2, rotate="promax", fm="pa")
fa.promax

# æ­£äº¤å’Œæ–œäº¤çš„åŒºåˆ«
# å¯¹æ­£äº¤æ—‹è½¬ï¼Œå› å­åˆ†æé‡ç‚¹åœ¨å› å­ç»“æ„çŸ©é˜µ
# å¯¹æ–œäº¤æ—‹è½¬ï¼Œå› å­åˆ†æä¼šè€ƒè™‘ä¸‰ä¸ªçŸ©é˜µï¼šå› å­ç»“æ„çŸ©é˜µã€å› å­æ¨¡å¼çŸ©é˜µã€å› å­å…³è”çŸ©é˜µ
#             å› å­æ¨¡å¼çŸ©é˜µï¼šå³æ ‡å‡†åŒ–åçš„å›å½’ç³»æ•°çŸ©é˜µï¼Œåˆ—å‡ºå› å­é¢„æµ‹å˜é‡çš„æƒé‡
#             å› å­å…³è”çŸ©é˜µï¼šå³å› å­ç›¸å…³ç³»æ•°çŸ©é˜µ

# ç»˜åˆ¶æ­£äº¤æˆ–æ–œäº¤å›¾å½¢
factor.plot(fa.promax, labels = rownames(fa.promax$loadings))
fa.diagrams(fa.varimax, simple = F)
fa <- fa(correlations, nfactors=2, rotate="none", fm="pa", score = T)
fa$weights # å¾—åˆ†æƒé‡

install.packages("GPArotation")
library(GPArotation)

# P63     è´­ç‰©ç¯®åˆ†æ------------------------------------------------------------

# æ•°æ®åŠ è½½
install.packages("arules")
library(arules)
data(Groceries)
inspect(Groceries) # æŸ¥çœ‹æ•°æ®é›†å†…å®¹

fit <- apriori(Groceries, parameter = list(support=0.01, confidence=0.5))
summary(fit)
inspect(fit)
# liftæŒ‡æ•°è¶Šå¤§ï¼Œé€»è¾‘å¯èƒ½æ€§è¶Šå¤§



# P64-65  åè®°------------------------------------------------------------------

# ç™½å«–ä¸æ˜“ï¼Œå„è‡ªçæƒœã€‚

# å¸Œæœ›ä¸–ç•Œå’Œå¹³ã€‚

###---åœ¨Rä¸­è°ƒç”¨MATLAB
#å®‰è£…R.matlabåŒ…
install.packages("R.matlab")
#è½½å…¥R.matlabåŒ…
library(R.matlab)

#è®¾ç½®matlabæ–‡ä»¶çš„è·¯å¾„
path<-system.file("mat-files",package="R.matlab")

#è¯»å–matlabæ–‡ä»¶
mat<-readMat(file.path(path,"structLooped.mat"))

#å¯¹è¯»å–å†…å®¹ï¼ˆå­˜æ”¾åœ¨matå˜é‡ä¸­ï¼‰è¿›è¡Œæ“ä½œï¼ˆmatå˜é‡ï¼‰
s<-mat$s
fields<-dimnames(S)[[1]]
cat("Field names:",paste(fields,collapse=","),"\n",sep=" ")
print(s)

